import{_ as ce,u as pe,r as m,z as I,i as ve,c as r,a as e,d,b as k,k as i,v as x,h as w,F as P,n as U,l as me,t as u,e as ge,T as _e,j as y,o as n,x as _,q,w as z,m as F}from"./index-Mv3MxCR1.js";import{S as f}from"./sweetalert2.esm.all-BQxta0Da.js";import{S as j}from"./search-DW_529iS.js";import{P as fe}from"./plus-BF4bXWAK.js";import{C as he}from"./chevron-left-C_DfDUMJ.js";import{C as be}from"./chevron-right-u8dkcCrv.js";import{P as ke,T as ye}from"./trash-2-CXOSxmzs.js";import{a as Ce,U as xe}from"./user-plus-Cdh2V3rs.js";import{X as we,C as Se}from"./x-D8hPaNXE.js";import{U as Te}from"./user-tPY_dJA_.js";import{C as G}from"./chevron-down-DSZpuO8w.js";import{B as $e}from"./briefcase-DeOdw5oH.js";import{A as ze}from"./award-QoisiMBi.js";import{C as W}from"./calendar-COvuOzBD.js";import"./createLucideIcon-DBeZuCHW.js";const je={class:"master-data-page"},De={class:"header-section"},Be={class:"header-actions"},Pe={class:"search-wrapper"},Ue=["disabled"],Le=["disabled"],Me={class:"card table-card shadow-lg"},Ae={key:0,class:"loading-state"},Ve={key:1,class:"empty-state"},Je={class:"empty-icon text-slate-300"},Ne={key:2,class:"table-container"},Ee={class:"modern-table"},Ie={class:"flex flex-col"},qe={class:"font-bold text-slate-800"},Fe={class:"text-xs text-slate-500"},Ge={class:"font-semibold text-indigo-600"},Ke={class:"text-sm"},He={class:"flex flex-col text-xs"},Oe={key:0,class:"text-slate-500"},Ye={class:"actions-group"},Qe=["onClick","disabled"],Re=["onClick","disabled"],Xe={class:"pagination-footer"},We={class:"per-page-selector"},Ze=["disabled"],ea={class:"pagination-controls"},aa={class:"page-info"},ta={class:"page-buttons"},sa=["disabled"],la=["disabled"],na={class:"modal-content"},oa={class:"modal-header"},ia={class:"header-icon"},ra={class:"header-text"},da=["disabled"],ua={class:"form-grid"},ca={class:"form-group span-2"},pa={class:"searchable-select"},va=["value"],ma={key:0,class:"select-dropdown"},ga={class:"search-box"},_a={class:"options-list custom-scrollbar"},fa=["onClick"],ha={key:0,class:"empty-option"},ba={class:"form-group"},ka={class:"searchable-select"},ya=["value"],Ca={key:0,class:"select-dropdown"},xa={class:"search-box"},wa={class:"options-list custom-scrollbar"},Sa=["onClick"],Ta={key:0,class:"empty-option"},$a={class:"form-group"},za={class:"searchable-select"},ja=["value"],Da={key:0,class:"select-dropdown"},Ba={class:"search-box"},Pa={class:"options-list custom-scrollbar"},Ua=["onClick"],La={key:0,class:"empty-option"},Ma={class:"form-group"},Aa={class:"input-wrapper"},Va={class:"form-group"},Ja={class:"input-wrapper"},Na={class:"form-group span-2"},Ea={class:"status-toggle-group"},Ia={class:"modal-footer"},qa=["disabled"],Fa=["disabled"],Ga={key:0,class:"spinner small"},Ka={__name:"ServiceAssignments",setup(Ha){const Z=pe(),L=m([]),M=m(!0),c=m(!1),h=m(!1),v=m(null),A=m(""),K=m(null),D=m([]),S=m([]),T=m([]),l=m({jemaat:!1,department:!1,position:!1,jemaatSearch:"",departmentSearch:"",positionSearch:""}),p=m({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),V=()=>({member_id:"",department_id:"",position_id:"",branch_id:Z.activeBranch.id,start_date:"",end_date:"",status:"active"}),o=m(V()),H=s=>s?new Date(s).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"}):"-",ee=()=>{clearTimeout(K.value),K.value=setTimeout(()=>b(1),500)},b=async(s=1)=>{M.value=!0;try{const a=await y.get("/service-assignments",{params:{page:s,per_page:p.value.per_page,search:A.value}});L.value=a.data.data,p.value={current_page:a.data.current_page,last_page:a.data.last_page,per_page:a.data.per_page,total:a.data.total,from:a.data.from,to:a.data.to}}catch(a){console.error(a),f.fire("Error","Gagal memuat data","error")}finally{M.value=!1}},ae=async()=>{try{const[s,a,t]=await Promise.all([y.get("/jemaat",{params:{per_page:1e3}}),y.get("/departments",{params:{per_page:1e3}}),y.get("/positions",{params:{per_page:1e3}})]);D.value=s.data.data||[],S.value=a.data.data||[],T.value=t.data.data||[],console.log("Departments:",S.value),console.log("Positions:",T.value)}catch(s){console.error("Error fetching master data:",s)}},O=I(()=>l.value.jemaatSearch?D.value.filter(s=>s.nama_lengkap?.toLowerCase().includes(l.value.jemaatSearch.toLowerCase())||s.email?.toLowerCase().includes(l.value.jemaatSearch.toLowerCase())):D.value),Y=I(()=>l.value.departmentSearch?S.value.filter(s=>s.name?.toLowerCase().includes(l.value.departmentSearch.toLowerCase())):S.value),Q=I(()=>l.value.positionSearch?T.value.filter(s=>s.name?.toLowerCase().includes(l.value.positionSearch.toLowerCase())):T.value),J=s=>{l.value.jemaat=s==="jemaat"?!l.value.jemaat:!1,l.value.department=s==="department"?!l.value.department:!1,l.value.position=s==="position"?!l.value.position:!1},te=s=>{o.value.member_id=s.id,l.value.jemaat=!1,l.value.jemaatSearch=""},se=s=>{o.value.department_id=s.id,l.value.department=!1,l.value.departmentSearch=""},le=s=>{o.value.position_id=s.id,l.value.position=!1,l.value.positionSearch=""},ne=()=>{const s=D.value.find(a=>a.id===o.value.member_id);return s?`${s.nama_lengkap} - ${s.email}`:""},oe=()=>{const s=S.value.find(a=>a.id===o.value.department_id);return s?s.name:""},ie=()=>{const s=T.value.find(a=>a.id===o.value.position_id);return s?s.name:""};typeof window<"u"&&window.addEventListener("click",s=>{s.target.closest(".searchable-select")||(l.value.jemaat=!1,l.value.department=!1,l.value.position=!1)});const R=(s=null)=>{s?(v.value=s.id,o.value={...s,branch_id:s.branch_id||localStorage.getItem("active_branch_id")}):(v.value=null,o.value=V()),h.value=!0},B=()=>{h.value=!1,o.value=V(),v.value=null},X=async()=>{c.value=!0;try{if(v.value)await y.put(`/service-assignments/${v.value}`,o.value),f.fire("Berhasil","Data penugasan berhasil diperbarui","success");else{const s=await y.post("/service-assignments",o.value);f.fire("Berhasil",s.data.message||"Data penugasan berhasil disimpan","success")}B(),b(p.value.current_page)}catch(s){if(console.error("Save error:",s),s.response?.status===422&&s.response?.data?.errors){const a=s.response.data.errors,t={...o.value},C=v.value;h.value=!1;const de={member_id:"Jemaat",department_id:"Departemen",position_id:"Jabatan",branch_id:"Cabang",start_date:"Tanggal Mulai",end_date:"Tanggal Selesai",status:"Status"};let N='<ul style="text-align: left; margin: 0; padding-left: 20px;">';Object.keys(a).forEach(g=>{const $=de[g]||g.replace(/_/g," ").replace(/\b\w/g,E=>E.toUpperCase());a[g].forEach(E=>{let ue=E.replace("The "+g+" field is required.",`${$} wajib diisi.`).replace("The "+g+" must be a valid date.",`${$} harus berupa tanggal yang valid.`).replace("The "+g+" field must be a date after or equal to "+g+".",`${$} harus sama atau setelah tanggal mulai.`).replace(g,$);N+=`<li><strong>${$}:</strong> ${ue}</li>`})}),N+="</ul>",f.fire({icon:"error",title:"Validasi Gagal",html:`<div style="font-size: 0.95rem;">${N}</div>`,confirmButtonColor:"#6366f1",confirmButtonText:"OK"}).then(()=>{o.value=t,v.value=C,h.value=!0})}else{const a={...o.value},t=v.value;h.value=!1,f.fire({icon:"error",title:"Gagal Menyimpan",text:s.response?.data?.message||s.message||"Terjadi kesalahan saat menyimpan data",confirmButtonColor:"#6366f1",confirmButtonText:"OK"}).then(()=>{o.value=a,v.value=t,h.value=!0})}}finally{c.value=!1}},re=async s=>{if((await f.fire({title:"Hapus Penugasan?",text:`Yakin ingin menghapus penugasan ${s.member?.nama_lengkap}?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#64748b",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"})).isConfirmed)try{await y.delete(`/service-assignments/${s.id}`),f.fire("Terhapus!","Data penugasan berhasil dihapus","success"),b(p.value.current_page)}catch{f.fire("Gagal","Gagal menghapus data","error")}};return ve(()=>{b(),ae()}),(s,a)=>(n(),r("div",je,[e("div",De,[a[22]||(a[22]=e("div",{class:"title-group"},[e("h1",{class:"page-title"},"Penugasan Pelayanan"),e("p",{class:"page-subtitle"},"Kelola penugasan jemaat ke departemen dan jabatan pelayanan")],-1)),e("div",Be,[e("div",Pe,[d(i(j),{size:"18",class:"search-icon"}),k(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>A.value=t),type:"text",placeholder:"Cari penugasan...",class:"search-input",onInput:ee,disabled:c.value},null,40,Ue),[[x,A.value]])]),e("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=t=>R()),disabled:c.value},[d(i(fe),{size:"18"}),a[20]||(a[20]=w()),a[21]||(a[21]=e("span",null,"Tambah Penugasan",-1))],8,Le)])]),e("div",Me,[M.value?(n(),r("div",Ae,[...a[23]||(a[23]=[e("div",{class:"spinner"},null,-1),e("p",null,"Memuat data...",-1)])])):L.value.length===0?(n(),r("div",Ve,[e("div",Je,[d(i(j),{size:"48"})]),a[24]||(a[24]=e("p",{class:"mt-4 font-medium text-slate-500"},"Tidak ada data penugasan ditemukan.",-1))])):(n(),r("div",Ne,[e("table",Ee,[a[25]||(a[25]=e("thead",null,[e("tr",null,[e("th",null,"Jemaat"),e("th",null,"Departemen"),e("th",null,"Jabatan"),e("th",null,"Periode"),e("th",null,"Status"),e("th",{class:"text-right"},"Aksi")])],-1)),e("tbody",null,[(n(!0),r(P,null,U(L.value,t=>(n(),r("tr",{key:t.id,class:"row-hover"},[e("td",null,[e("div",Ie,[e("span",qe,u(t.member?.nama_lengkap||"-"),1),e("span",Fe,u(t.member?.email||"-"),1)])]),e("td",null,[e("span",Ge,u(t.department?.name||"-"),1)]),e("td",null,[e("span",Ke,u(t.position?.name||"-"),1)]),e("td",null,[e("div",He,[e("span",null,u(H(t.start_date)),1),t.end_date?(n(),r("span",Oe,"s/d "+u(H(t.end_date)),1)):_("",!0)])]),e("td",null,[e("span",{class:q(["status-pill",t.status])},u(t.status==="active"?"Aktif":"Tidak Aktif"),3)]),e("td",null,[e("div",Ye,[e("button",{class:"action-btn edit",onClick:C=>R(t),title:"Ubah",disabled:c.value},[d(i(ke),{size:"16"})],8,Qe),e("button",{class:"action-btn delete",onClick:C=>re(t),title:"Hapus",disabled:c.value},[d(i(ye),{size:"16"})],8,Re)])])]))),128))])]),e("div",Xe,[e("div",We,[a[27]||(a[27]=e("span",{class:"text-[10px] font-extrabold text-slate-400 uppercase tracking-widest"},"TAMPILKAN",-1)),k(e("select",{"onUpdate:modelValue":a[2]||(a[2]=t=>p.value.per_page=t),onChange:a[3]||(a[3]=t=>b(1)),disabled:c.value},[...a[26]||(a[26]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)])],40,Ze),[[me,p.value.per_page]])]),e("div",ea,[e("span",aa,[e("b",null,u(p.value.from||0)+"-"+u(p.value.to||0),1),a[28]||(a[28]=w(" dari ",-1)),e("b",null,u(p.value.total),1)]),e("div",ta,[e("button",{class:"page-btn",disabled:p.value.current_page===1||c.value,onClick:a[4]||(a[4]=t=>b(p.value.current_page-1))},[d(i(he),{size:"18"})],8,sa),e("button",{class:"page-btn",disabled:p.value.current_page===p.value.last_page||c.value,onClick:a[5]||(a[5]=t=>b(p.value.current_page+1))},[d(i(be),{size:"18"})],8,la)])])])]))]),d(_e,{name:"modal-fade"},{default:ge(()=>[h.value?(n(),r("div",{key:0,class:"modal-overlay",onClick:a[19]||(a[19]=z(t=>!c.value&&B(),["self"]))},[e("div",na,[e("div",oa,[e("div",ia,[v.value?(n(),F(i(xe),{key:1,size:"24"})):(n(),F(i(Ce),{key:0,size:"24"}))]),e("div",ra,[e("h2",null,u(v.value?"Update Penugasan":"Tambah Penugasan Baru"),1),e("p",null,u(v.value?"Ubah informasi penugasan pelayanan":"Lengkapi formulir untuk menugaskan jemaat"),1)]),e("button",{class:"close-btn",onClick:B,disabled:c.value},[d(i(we),{size:"20"})],8,da)]),e("form",{onSubmit:z(X,["prevent"]),class:"modal-body custom-scrollbar"},[e("div",ua,[e("div",ca,[a[29]||(a[29]=e("label",{class:"form-label"},[w("Jemaat "),e("span",{class:"text-red-500"},"*")],-1)),e("div",pa,[e("div",{class:"input-wrapper cursor-pointer",onClick:a[6]||(a[6]=t=>J("jemaat"))},[d(i(Te),{size:"18",class:"input-icon"}),e("input",{type:"text",value:ne(),placeholder:"Pilih Jemaat",readonly:"",required:""},null,8,va),d(i(G),{size:"18",style:{position:"absolute",right:"1rem",color:"#94a3b8"}})]),l.value.jemaat?(n(),r("div",ma,[e("div",ga,[d(i(j),{size:"16",class:"search-icon"}),k(e("input",{"onUpdate:modelValue":a[7]||(a[7]=t=>l.value.jemaatSearch=t),type:"text",placeholder:"Cari jemaat...",class:"search-input",onClick:a[8]||(a[8]=z(()=>{},["stop"]))},null,512),[[x,l.value.jemaatSearch]])]),e("ul",_a,[(n(!0),r(P,null,U(O.value,t=>(n(),r("li",{key:t.id,onClick:C=>te(t)},u(t.nama_lengkap)+" - "+u(t.email),9,fa))),128)),O.value.length===0?(n(),r("li",ha,"Tidak ada data")):_("",!0)])])):_("",!0)])]),e("div",ba,[a[30]||(a[30]=e("label",{class:"form-label"},[w("Departemen "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ka,[e("div",{class:"input-wrapper cursor-pointer",onClick:a[9]||(a[9]=t=>J("department"))},[d(i($e),{size:"18",class:"input-icon"}),e("input",{type:"text",value:oe(),placeholder:"Pilih Departemen",readonly:"",required:""},null,8,ya),d(i(G),{size:"18",style:{position:"absolute",right:"1rem",color:"#94a3b8"}})]),l.value.department?(n(),r("div",Ca,[e("div",xa,[d(i(j),{size:"16",class:"search-icon"}),k(e("input",{"onUpdate:modelValue":a[10]||(a[10]=t=>l.value.departmentSearch=t),type:"text",placeholder:"Cari departemen...",class:"search-input",onClick:a[11]||(a[11]=z(()=>{},["stop"]))},null,512),[[x,l.value.departmentSearch]])]),e("ul",wa,[(n(!0),r(P,null,U(Y.value,t=>(n(),r("li",{key:t.id,onClick:C=>se(t)},u(t.name),9,Sa))),128)),Y.value.length===0?(n(),r("li",Ta,"Tidak ada data")):_("",!0)])])):_("",!0)])]),e("div",$a,[a[31]||(a[31]=e("label",{class:"form-label"},[w("Jabatan "),e("span",{class:"text-red-500"},"*")],-1)),e("div",za,[e("div",{class:"input-wrapper cursor-pointer",onClick:a[12]||(a[12]=t=>J("position"))},[d(i(ze),{size:"18",class:"input-icon"}),e("input",{type:"text",value:ie(),placeholder:"Pilih Jabatan",readonly:"",required:""},null,8,ja),d(i(G),{size:"18",style:{position:"absolute",right:"1rem",color:"#94a3b8"}})]),l.value.position?(n(),r("div",Da,[e("div",Ba,[d(i(j),{size:"16",class:"search-icon"}),k(e("input",{"onUpdate:modelValue":a[13]||(a[13]=t=>l.value.positionSearch=t),type:"text",placeholder:"Cari jabatan...",class:"search-input",onClick:a[14]||(a[14]=z(()=>{},["stop"]))},null,512),[[x,l.value.positionSearch]])]),e("ul",Pa,[(n(!0),r(P,null,U(Q.value,t=>(n(),r("li",{key:t.id,onClick:C=>le(t)},u(t.name),9,Ua))),128)),Q.value.length===0?(n(),r("li",La,"Tidak ada data")):_("",!0)])])):_("",!0)])]),e("div",Ma,[a[32]||(a[32]=e("label",{class:"form-label"},[w("Tanggal Mulai "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Aa,[d(i(W),{size:"18",class:"input-icon"}),k(e("input",{"onUpdate:modelValue":a[15]||(a[15]=t=>o.value.start_date=t),type:"date",required:""},null,512),[[x,o.value.start_date]])])]),e("div",Va,[a[33]||(a[33]=e("label",{class:"form-label"},"Tanggal Selesai",-1)),e("div",Ja,[d(i(W),{size:"18",class:"input-icon"}),k(e("input",{"onUpdate:modelValue":a[16]||(a[16]=t=>o.value.end_date=t),type:"date"},null,512),[[x,o.value.end_date]])])]),e("div",Na,[a[34]||(a[34]=e("label",{class:"form-label"},"Status",-1)),e("div",Ea,[e("button",{type:"button",class:q(["status-btn",{active:o.value.status==="active"}]),onClick:a[17]||(a[17]=t=>o.value.status="active")}," Aktif ",2),e("button",{type:"button",class:q(["status-btn",{active:o.value.status==="inactive"}]),onClick:a[18]||(a[18]=t=>o.value.status="inactive")}," Tidak Aktif ",2)])])])],32),e("div",Ia,[e("button",{type:"button",class:"btn btn-ghost",onClick:B,disabled:c.value},"Batal",8,qa),e("button",{type:"submit",class:"btn btn-primary",onClick:X,disabled:c.value},[c.value?(n(),r("span",Ga)):(n(),F(i(Se),{key:1,size:"18"})),e("span",null,u(v.value?"Update":"Simpan"),1)],8,Fa)])])])):_("",!0)]),_:1})]))}},rt=ce(Ka,[["__scopeId","data-v-f5b585fb"]]);export{rt as default};
