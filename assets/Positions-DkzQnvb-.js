import{_ as F,u as K,r as c,z as q,A as H,i as O,c as l,a,d as r,b as f,k as d,v as A,h as $,F as g,n as T,l as z,t as u,e as Q,T as X,j as h,o as s,x as Y,w as J,m as N}from"./index-Mv3MxCR1.js";import{S as b}from"./sweetalert2.esm.all-BQxta0Da.js";import{S as U}from"./search-DW_529iS.js";import{P as V}from"./plus-BF4bXWAK.js";import{C as W}from"./chevron-left-C_DfDUMJ.js";import{C as Z}from"./chevron-right-u8dkcCrv.js";import{P as j,T as aa}from"./trash-2-CXOSxmzs.js";import{X as ea,C as ta}from"./x-D8hPaNXE.js";import{T as sa}from"./type-zrf9LQ7g.js";import{B as na}from"./bookmark-BwJlAJ1n.js";import{B as la}from"./briefcase-DeOdw5oH.js";import"./createLucideIcon-DBeZuCHW.js";const oa={class:"master-data-page wide"},ia={class:"header-section"},da={class:"header-actions"},ra={class:"search-wrapper"},ua=["disabled"],pa=["disabled"],ca={class:"card table-card"},va={key:0,class:"loading-state"},ma={key:1,class:"empty-state"},ba={class:"empty-icon"},_a={key:2,class:"table-container"},ha={class:"modern-table"},fa={class:"order-badge"},ga={class:"font-bold text-dark"},ka={key:0,class:"dept-tag"},ya={key:1,class:"text-muted text-xs"},wa={key:0,class:"parent-tag"},xa={key:1,class:"text-muted text-xs italic"},Ca={class:"actions-group"},Ba=["onClick","disabled"],Ta=["onClick","disabled"],za={class:"pagination-footer"},Pa={class:"per-page-selector"},Da=["disabled"],Sa={class:"pagination-controls"},Ma={class:"page-info"},Aa={class:"page-buttons"},$a=["disabled"],Ja=["disabled"],Na={class:"modal-content"},Ua={class:"modal-header"},Va={class:"header-icon"},ja={class:"header-text"},Ea=["disabled"],La={class:"form-section"},Ga={class:"form-group full-width"},Ia={class:"input-wrapper"},Ra=["disabled"],Fa={class:"form-group full-width"},Ka={class:"input-wrapper"},qa=["disabled"],Ha=["value"],Oa={class:"form-group full-width"},Qa={class:"input-wrapper"},Xa=["disabled"],Ya=["value","disabled"],Wa={class:"modal-footer"},Za=["disabled"],ae=["disabled"],ee={__name:"Positions",setup(te){const _=K(),y=c([]),P=c([]),D=c([]),w=c(!0),n=c(!1),x=c(!1),v=c(null),C=c(""),S=c(null),o=c({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),p=c({name:"",department_id:"",parent_id:null,branch_id:null}),E=q(()=>D.value),m=async(i=1)=>{if(_.activeBranch){w.value=!0;try{const[e,t,B]=await Promise.all([h.get("/positions",{params:{branch_id:_.activeBranch.id,page:i,per_page:o.value.per_page,search:C.value}}),h.get("/departments",{params:{branch_id:_.activeBranch.id,per_page:999}}),h.get("/positions",{params:{branch_id:_.activeBranch.id,per_page:999}})]);y.value=e.data.data,o.value={current_page:e.data.current_page,last_page:e.data.last_page,per_page:e.data.per_page,total:e.data.total,from:e.data.from,to:e.data.to},P.value=t.data.data,D.value=B.data.data}catch(e){console.error("Failed to fetch positions",e),b.fire("Error","Gagal memuat data jabatan.","error")}finally{w.value=!1}}},L=()=>{clearTimeout(S.value),S.value=setTimeout(()=>{m(1)},500)};H(()=>_.activeBranch,i=>{i&&m(1)},{immediate:!0}),O(()=>{m()});const M=(i=null)=>{i?(v.value=i.id,p.value={name:i.name,department_id:i.department_id,parent_id:i.parent_id,branch_id:i.branch_id}):(v.value=null,p.value={name:"",department_id:"",parent_id:null,branch_id:_.activeBranch?.id}),x.value=!0},k=()=>{x.value=!1},G=async()=>{if(!p.value.branch_id){b.fire("Error","Silakan pilih cabang terlebih dahulu.","error");return}n.value=!0;try{v.value?await h.put(`/positions/${v.value}`,p.value):await h.post("/positions",p.value),await m(o.value.current_page),k(),b.fire({icon:"success",title:"Berhasil!",text:"Data jabatan telah diperbarui.",timer:2e3,showConfirmButton:!1})}catch{b.fire("Error","Gagal menyimpan data.","error")}finally{n.value=!1}},I=async i=>{if((await b.fire({title:"Apakah Anda yakin?",text:`Jabatan "${i.name}" akan dihapus permanen!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"})).isConfirmed)try{await h.delete(`/positions/${i.id}`),await m(o.value.current_page),b.fire("Dihapus!","Data telah berhasil dihapus.","success")}catch{b.fire("Error","Gagal menghapus data.","error")}};return(i,e)=>(s(),l("div",oa,[a("div",ia,[e[12]||(e[12]=a("div",{class:"title-group"},[a("h1",{class:"page-title"},"Master Jabatan"),a("p",{class:"page-subtitle"},"Kelola daftar jabatan dan struktur pelaporan di cabang ini")],-1)),a("div",da,[a("div",ra,[r(d(U),{size:"18",class:"search-icon"}),f(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),type:"text",placeholder:"Cari jabatan...",class:"search-input",onInput:L,disabled:n.value},null,40,ua),[[A,C.value]])]),a("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=t=>M()),disabled:n.value},[r(d(V),{size:"18"}),e[10]||(e[10]=$()),e[11]||(e[11]=a("span",null,"Tambah Jabatan",-1))],8,pa)])]),a("div",ca,[w.value?(s(),l("div",va,[...e[13]||(e[13]=[a("div",{class:"spinner"},null,-1),a("p",null,"Memuat data...",-1)])])):y.value.length===0?(s(),l("div",ma,[a("div",ba,[r(d(U),{size:"48"})]),e[14]||(e[14]=a("p",null,"Tidak ada data yang ditemukan.",-1))])):(s(),l("div",_a,[a("table",ha,[e[15]||(e[15]=a("thead",null,[a("tr",null,[a("th",{style:{width:"80px"}},"No"),a("th",null,"Nama Jabatan"),a("th",null,"Departemen"),a("th",null,"Atasan Langsung"),a("th",{class:"text-right"},"Aksi")])],-1)),a("tbody",null,[(s(!0),l(g,null,T(y.value,(t,B)=>(s(),l("tr",{key:t.id,class:"row-hover"},[a("td",null,[a("span",fa,u(o.value.from+B),1)]),a("td",ga,u(t.name),1),a("td",null,[t.department?(s(),l("span",ka,u(t.department.name),1)):(s(),l("span",ya,"-"))]),a("td",null,[t.parent?(s(),l("span",wa,u(t.parent.name),1)):(s(),l("span",xa,"Puncak (Top)"))]),a("td",null,[a("div",Ca,[a("button",{class:"action-btn edit",onClick:R=>M(t),title:"Ubah",disabled:n.value},[r(d(j),{size:"16"})],8,Ba),a("button",{class:"action-btn delete",onClick:R=>I(t),title:"Hapus",disabled:n.value},[r(d(aa),{size:"16"})],8,Ta)])])]))),128))])]),a("div",za,[a("div",Pa,[e[17]||(e[17]=a("span",{class:"text-xs font-bold text-muted"},"TAMPILKAN",-1)),f(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.per_page=t),onChange:e[3]||(e[3]=t=>m(1)),disabled:n.value},[...e[16]||(e[16]=[a("option",{value:10},"10 data",-1),a("option",{value:25},"25 data",-1),a("option",{value:50},"50 data",-1),a("option",{value:100},"100 data",-1)])],40,Da),[[z,o.value.per_page]])]),a("div",Sa,[a("span",Ma,[a("b",null,u(o.value.from||0)+"-"+u(o.value.to||0),1),e[18]||(e[18]=$(" dari ",-1)),a("b",null,u(o.value.total),1)]),a("div",Aa,[a("button",{class:"page-btn",disabled:o.value.current_page===1||n.value,onClick:e[4]||(e[4]=t=>m(o.value.current_page-1))},[r(d(W),{size:"18"})],8,$a),a("button",{class:"page-btn",disabled:o.value.current_page===o.value.last_page||n.value,onClick:e[5]||(e[5]=t=>m(o.value.current_page+1))},[r(d(Z),{size:"18"})],8,Ja)])])])]))]),r(X,{name:"modal-fade"},{default:Q(()=>[x.value?(s(),l("div",{key:0,class:"modal-overlay",onClick:e[9]||(e[9]=J(t=>!n.value&&k(),["self"]))},[a("div",Na,[a("div",Ua,[a("div",Va,[v.value?(s(),N(d(j),{key:1,size:"24"})):(s(),N(d(V),{key:0,size:"24"}))]),a("div",ja,[a("h2",null,u(v.value?"Update Jabatan":"Tambah Jabatan Baru"),1),a("p",null,u(v.value?"Ubah informasi jabatan yang sudah ada":"Sebutkan nama jabatan dan hierarkinya"),1)]),a("button",{class:"close-btn",onClick:k,disabled:n.value},[r(d(ea),{size:"20"})],8,Ea)]),a("form",{onSubmit:J(G,["prevent"]),class:"modal-body"},[a("div",La,[a("div",Ga,[e[19]||(e[19]=a("label",{class:"form-label"},"Nama Jabatan",-1)),a("div",Ia,[r(d(sa),{size:"18",class:"input-icon"}),f(a("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>p.value.name=t),type:"text",required:"",placeholder:"Contoh: Gembala, Bendahara, Koordinator, dll.",disabled:n.value},null,8,Ra),[[A,p.value.name]])])]),a("div",Fa,[e[21]||(e[21]=a("label",{class:"form-label"},"Departemen",-1)),a("div",Ka,[r(d(na),{size:"18",class:"input-icon"}),f(a("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>p.value.department_id=t),required:"",disabled:n.value},[e[20]||(e[20]=a("option",{value:"",disabled:""},"-- Pilih Departemen --",-1)),(s(!0),l(g,null,T(P.value,t=>(s(),l("option",{key:t.id,value:t.id},u(t.name),9,Ha))),128))],8,qa),[[z,p.value.department_id]])])]),a("div",Oa,[e[23]||(e[23]=a("label",{class:"form-label"},"Atasan Langsung (Opsional)",-1)),a("div",Qa,[r(d(la),{size:"18",class:"input-icon"}),f(a("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>p.value.parent_id=t),disabled:n.value},[e[22]||(e[22]=a("option",{value:null},"-- Tidak Ada (Pimpinan Tertinggi) --",-1)),(s(!0),l(g,null,T(E.value,t=>(s(),l("option",{key:t.id,value:t.id,disabled:t.id===v.value},u(t.name)+" ("+u(t.department?.name||"No Dept")+") ",9,Ya))),128))],8,Xa),[[z,p.value.parent_id]])])])]),a("div",Wa,[a("button",{type:"button",class:"btn btn-ghost",onClick:k,disabled:n.value},"Batal",8,Za),a("button",{type:"submit",class:"btn btn-primary btn-lg",disabled:n.value},[n.value?(s(),l(g,{key:0},[e[24]||(e[24]=a("div",{class:"spinner small"},null,-1)),e[25]||(e[25]=a("span",null,"Menyimpan...",-1))],64)):(s(),l(g,{key:1},[r(d(ta),{size:"18"}),a("span",null,u(v.value?"Update Jabatan":"Simpan Jabatan"),1)],64))],8,ae)])],32)])])):Y("",!0)]),_:1})]))}},be=F(ee,[["__scopeId","data-v-ac7e31f8"]]);export{be as default};
