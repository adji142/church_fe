import{_ as X,u as Y,r as v,A as Z,i as ee,c as i,a as e,x as f,d as u,b as p,k as d,v as x,h as g,q as $,F as y,n as V,l as F,t as c,e as ae,T as te,j as q,o as n,w as E,m as I,y as w}from"./index-Mv3MxCR1.js";import{S as _}from"./sweetalert2.esm.all-BQxta0Da.js";import{S as G}from"./search-DW_529iS.js";import{P as L}from"./plus-BF4bXWAK.js";import{C as se}from"./chevron-left-C_DfDUMJ.js";import{C as le}from"./chevron-right-u8dkcCrv.js";import{C as oe}from"./circle-check-big-BN4MHkMS.js";import{C as ne}from"./calendar-COvuOzBD.js";import{F as ie}from"./file-text-CPaFxqa6.js";import{P as j,T as de}from"./trash-2-CXOSxmzs.js";import{X as J,C as re}from"./x-D8hPaNXE.js";import"./createLucideIcon-DBeZuCHW.js";const ue={class:"master-data-page"},ce={class:"header-section"},pe={class:"header-actions"},ve={class:"search-wrapper"},me=["disabled"],be=["disabled"],_e={key:0,class:"filter-section"},he={class:"filter-group"},fe={class:"filter-buttons"},ge=["onClick"],ye={class:"card table-card"},ke={key:0,class:"loading-state"},Ce={key:1,class:"empty-state"},xe={class:"empty-icon"},qe={key:2,class:"table-container"},we={class:"modern-table"},Te={class:"order-badge"},Be={class:"font-bold text-dark"},Ue={class:"text-xs text-muted"},Ve={class:"category-badge"},ze={class:"code-badge"},De={class:"config-icons"},Se={key:0,title:"Butuh Approval"},Ae={key:1,title:"Ada Jadwal"},$e={key:2,title:"Dokumen Lengkap"},Le={class:"actions-group"},Me=["onClick","disabled"],Ne=["onClick","disabled"],Pe={class:"pagination-footer"},Ke={class:"per-page-selector"},Fe=["disabled"],Ee={class:"pagination-controls"},Ie={class:"page-info"},Ge={class:"page-buttons"},je=["disabled"],Je=["disabled"],Re={class:"modal-content large-modal"},He={class:"modal-header"},We={class:"header-icon"},Oe={class:"header-text"},Qe=["disabled"],Xe={class:"form-grid"},Ye={class:"form-column"},Ze={class:"form-group"},ea=["disabled"],aa=["value"],ta={class:"form-group"},sa=["disabled"],la={class:"form-group"},oa=["disabled"],na={class:"form-group"},ia=["disabled"],da={class:"form-group checkboxes-group"},ra={class:"checkbox-label"},ua=["disabled"],ca={class:"checkbox-label"},pa=["disabled"],va={class:"checkbox-label"},ma=["disabled"],ba={class:"checkbox-label"},_a=["disabled"],ha={class:"form-column requirements-column"},fa={class:"requirements-header"},ga=["disabled"],ya={class:"requirements-list"},ka={key:0,class:"empty-reqs"},Ca={class:"req-content"},xa=["onUpdate:modelValue","disabled"],qa={class:"req-checkbox"},wa=["onUpdate:modelValue","disabled"],Ta=["onClick","disabled"],Ba={class:"modal-footer"},Ua=["disabled"],Va=["disabled"],za={__name:"ServiceTypes",setup(Da){const k=Y(),z=v([]),T=v([]),D=v(!0),s=v(!1),S=v(!1),b=v(null),A=v(""),B=v(null),M=v(null),r=v({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),l=v({service_category_id:"",name:"",code:"",description:"",requires_approval:!1,has_schedule:!1,has_document:!0,is_active:!0,church_id:null,requirements:[]}),N=async()=>{try{const o=await q.get("/service-categories",{params:{church_id:k.activeBranch.id,per_page:100}});T.value=o.data.data}catch(o){console.error("Failed to fetch categories",o)}},m=async(o=1)=>{if(k.activeBranch){D.value=!0;try{const a=await q.get("/service-types",{params:{church_id:k.activeBranch.id,page:o,per_page:r.value.per_page,search:A.value,service_category_id:B.value}});z.value=a.data.data,r.value={current_page:a.data.current_page,last_page:a.data.last_page,per_page:a.data.per_page,total:a.data.total,from:a.data.from,to:a.data.to}}catch(a){console.error("Failed to fetch types",a),_.fire("Error","Gagal memuat data tipe layanan.","error")}finally{D.value=!1}}},R=()=>{clearTimeout(M.value),M.value=setTimeout(()=>{m(1)},500)},P=o=>{B.value=o,m(1)};Z(()=>k.activeBranch,async o=>{o&&(await N(),m(1))},{immediate:!0}),ee(()=>{N(),m()});const H=()=>{l.value.requirements.push({name:"",is_required:!0})},W=o=>{const a=l.value.requirements[o];a.id?a.delete=!0:l.value.requirements.splice(o,1)},K=(o=null)=>{o?(b.value=o.id,l.value={...o,requirements:o.requirements?o.requirements.map(a=>({...a})):[]}):(b.value=null,l.value={service_category_id:"",name:"",code:"",description:"",requires_approval:!1,has_schedule:!1,has_document:!1,is_active:!0,church_id:k.activeBranch?.id,requirements:[]}),S.value=!0},U=()=>{S.value=!1},O=async()=>{if(!l.value.church_id){_.fire("Error","Silakan pilih cabang/gereja terlebih dahulu.","error");return}s.value=!0;try{b.value?await q.put(`/service-types/${b.value}`,l.value):await q.post("/service-types",l.value),await m(r.value.current_page),U(),_.fire({icon:"success",title:"Berhasil!",text:"Data layanan telah diperbarui.",timer:2e3,showConfirmButton:!1})}catch{_.fire("Error","Gagal menyimpan data.","error")}finally{s.value=!1}},Q=async o=>{if((await _.fire({title:"Apakah Anda yakin?",text:`Layanan "${o.name}" akan dihapus permanen!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"})).isConfirmed)try{await q.delete(`/service-types/${o.id}`),await m(r.value.current_page),_.fire("Dihapus!","Data telah berhasil dihapus.","success")}catch{_.fire("Error","Gagal menghapus data.","error")}};return(o,a)=>(n(),i("div",ue,[e("div",ce,[a[18]||(a[18]=e("div",{class:"title-group"},[e("h1",{class:"page-title"},"Master Tipe Layanan"),e("p",{class:"page-subtitle"},"Kelola tipe layanan (contoh: Pernikahan, Baptisan) dan syarat dokumen")],-1)),e("div",pe,[e("div",ve,[u(d(G),{size:"18",class:"search-icon"}),p(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>A.value=t),type:"text",placeholder:"Cari tipe layanan...",class:"search-input",onInput:R,disabled:s.value},null,40,me),[[x,A.value]])]),e("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=t=>K()),disabled:s.value},[u(d(L),{size:"18"}),a[16]||(a[16]=g()),a[17]||(a[17]=e("span",null,"Tambah Tipe",-1))],8,be)])]),T.value.length>0?(n(),i("div",_e,[e("div",he,[a[19]||(a[19]=e("span",{class:"filter-label"},"Filter Kategori:",-1)),e("div",fe,[e("button",{class:$(["filter-btn",B.value?"":"active"]),onClick:a[2]||(a[2]=t=>P(null))}," Semua ",2),(n(!0),i(y,null,V(T.value,t=>(n(),i("button",{key:t.id,class:$(["filter-btn",B.value===t.id?"active":""]),onClick:C=>P(t.id)},c(t.name),11,ge))),128))])])])):f("",!0),e("div",ye,[D.value?(n(),i("div",ke,[...a[20]||(a[20]=[e("div",{class:"spinner"},null,-1),e("p",null,"Memuat data...",-1)])])):z.value.length===0?(n(),i("div",Ce,[e("div",xe,[u(d(G),{size:"48"})]),a[21]||(a[21]=e("p",null,"Tidak ada data yang ditemukan.",-1))])):(n(),i("div",qe,[e("table",we,[a[25]||(a[25]=e("thead",null,[e("tr",null,[e("th",{style:{width:"80px"}},"No"),e("th",null,"Nama Layanan"),e("th",null,"Kategori"),e("th",null,"Code"),e("th",null,"Config"),e("th",null,"Status"),e("th",{class:"text-right"},"Aksi")])],-1)),e("tbody",null,[(n(!0),i(y,null,V(z.value,(t,C)=>(n(),i("tr",{key:t.id,class:"row-hover"},[e("td",null,[e("span",Te,c(r.value.from+C),1)]),e("td",null,[e("div",Be,c(t.name),1),e("div",Ue,c(t.requirements?.length||0)+" syarat dokumen",1)]),e("td",null,[e("span",Ve,c(t.category?.name||"-"),1)]),e("td",null,[e("span",ze,c(t.code||"-"),1)]),e("td",null,[e("div",De,[t.requires_approval?(n(),i("span",Se,[u(d(oe),{size:"14",class:"icon-success"}),a[22]||(a[22]=g(" Approval",-1))])):f("",!0),t.has_schedule?(n(),i("span",Ae,[u(d(ne),{size:"14",class:"icon-info"}),a[23]||(a[23]=g(" Jadwal",-1))])):f("",!0),t.has_document?(n(),i("span",$e,[u(d(ie),{size:"14",class:"icon-warning"}),a[24]||(a[24]=g(" Dokumen ",-1))])):f("",!0)])]),e("td",null,[e("span",{class:$(["status-badge",t.is_active?"active":"inactive"])},c(t.is_active?"Aktif":"Tidak Aktif"),3)]),e("td",null,[e("div",Le,[e("button",{class:"action-btn edit",onClick:h=>K(t),title:"Ubah",disabled:s.value},[u(d(j),{size:"16"})],8,Me),e("button",{class:"action-btn delete",onClick:h=>Q(t),title:"Hapus",disabled:s.value},[u(d(de),{size:"16"})],8,Ne)])])]))),128))])]),e("div",Pe,[e("div",Ke,[a[27]||(a[27]=e("span",{class:"text-xs font-bold text-muted"},"TAMPILKAN",-1)),p(e("select",{"onUpdate:modelValue":a[3]||(a[3]=t=>r.value.per_page=t),onChange:a[4]||(a[4]=t=>m(1)),disabled:s.value},[...a[26]||(a[26]=[e("option",{value:10},"10 data",-1),e("option",{value:25},"25 data",-1),e("option",{value:50},"50 data",-1),e("option",{value:100},"100 data",-1)])],40,Fe),[[F,r.value.per_page]])]),e("div",Ee,[e("span",Ie,[e("b",null,c(r.value.from||0)+"-"+c(r.value.to||0),1),a[28]||(a[28]=g(" dari ",-1)),e("b",null,c(r.value.total),1)]),e("div",Ge,[e("button",{class:"page-btn",disabled:r.value.current_page===1||s.value,onClick:a[5]||(a[5]=t=>m(r.value.current_page-1))},[u(d(se),{size:"18"})],8,je),e("button",{class:"page-btn",disabled:r.value.current_page===r.value.last_page||s.value,onClick:a[6]||(a[6]=t=>m(r.value.current_page+1))},[u(d(le),{size:"18"})],8,Je)])])])]))]),u(te,{name:"modal-fade"},{default:ae(()=>[S.value?(n(),i("div",{key:0,class:"modal-overlay",onClick:a[15]||(a[15]=E(t=>!s.value&&U(),["self"]))},[e("div",Re,[e("div",He,[e("div",We,[b.value?(n(),I(d(j),{key:1,size:"24"})):(n(),I(d(L),{key:0,size:"24"}))]),e("div",Oe,[e("h2",null,c(b.value?"Update Tipe Layanan":"Tambah Tipe Layanan"),1),e("p",null,c(b.value?"Ubah informasi tipe layanan dan syaratnya":"Buat tipe layanan baru"),1)]),e("button",{class:"close-btn",onClick:U,disabled:s.value},[u(d(J),{size:"20"})],8,Qe)]),e("form",{onSubmit:E(O,["prevent"]),class:"modal-body"},[e("div",Xe,[e("div",Ye,[a[38]||(a[38]=e("h3",{class:"section-title"},"Informasi Dasar",-1)),e("div",Ze,[a[30]||(a[30]=e("label",{class:"form-label"},"Kategori",-1)),p(e("select",{"onUpdate:modelValue":a[7]||(a[7]=t=>l.value.service_category_id=t),required:"",class:"select-input",disabled:s.value},[a[29]||(a[29]=e("option",{value:""},"Pilih Kategori",-1)),(n(!0),i(y,null,V(T.value,t=>(n(),i("option",{key:t.id,value:t.id},c(t.name),9,aa))),128))],8,ea),[[F,l.value.service_category_id]])]),e("div",ta,[a[31]||(a[31]=e("label",{class:"form-label"},"Nama Layanan",-1)),p(e("input",{"onUpdate:modelValue":a[8]||(a[8]=t=>l.value.name=t),type:"text",required:"",placeholder:"Contoh: Pemberkatan Nikah",disabled:s.value,class:"text-input"},null,8,sa),[[x,l.value.name]])]),e("div",la,[a[32]||(a[32]=e("label",{class:"form-label"},"Kode (Opsional)",-1)),p(e("input",{"onUpdate:modelValue":a[9]||(a[9]=t=>l.value.code=t),type:"text",placeholder:"Contoh: WEDDING",disabled:s.value,class:"text-input"},null,8,oa),[[x,l.value.code]])]),e("div",na,[a[33]||(a[33]=e("label",{class:"form-label"},"Deskripsi",-1)),p(e("textarea",{"onUpdate:modelValue":a[10]||(a[10]=t=>l.value.description=t),rows:"2",placeholder:"Keterangan singkat...",disabled:s.value,class:"text-area-input"},null,8,ia),[[x,l.value.description]])]),e("div",da,[e("label",ra,[p(e("input",{type:"checkbox","onUpdate:modelValue":a[11]||(a[11]=t=>l.value.requires_approval=t),disabled:s.value},null,8,ua),[[w,l.value.requires_approval]]),a[34]||(a[34]=e("span",null,"Perlu Approval",-1))]),e("label",ca,[p(e("input",{type:"checkbox","onUpdate:modelValue":a[12]||(a[12]=t=>l.value.has_schedule=t),disabled:s.value},null,8,pa),[[w,l.value.has_schedule]]),a[35]||(a[35]=e("span",null,"Ada Jadwal",-1))]),e("label",va,[p(e("input",{type:"checkbox","onUpdate:modelValue":a[13]||(a[13]=t=>l.value.has_document=t),disabled:s.value},null,8,ma),[[w,l.value.has_document]]),a[36]||(a[36]=e("span",null,"Upload Dokumen",-1))]),e("label",ba,[p(e("input",{type:"checkbox","onUpdate:modelValue":a[14]||(a[14]=t=>l.value.is_active=t),disabled:s.value},null,8,_a),[[w,l.value.is_active]]),a[37]||(a[37]=e("span",null,"Status Aktif",-1))])])]),e("div",ha,[e("div",fa,[a[40]||(a[40]=e("h3",{class:"section-title"},"Syarat Dokumen",-1)),e("button",{type:"button",class:"btn-add-req",onClick:H,disabled:s.value},[u(d(L),{size:"14"}),a[39]||(a[39]=g(" Tambah ",-1))],8,ga)]),e("div",ya,[l.value.requirements.length===0?(n(),i("div",ka," Belum ada syarat dokumen. ")):f("",!0),(n(!0),i(y,null,V(l.value.requirements,(t,C)=>(n(),i("div",{key:C,class:"req-item"},[e("div",Ca,[p(e("input",{"onUpdate:modelValue":h=>t.name=h,type:"text",placeholder:"Nama Dokumen (e.g., KTP)",class:"req-name-input",disabled:s.value,required:""},null,8,xa),[[x,t.name]]),e("label",qa,[p(e("input",{type:"checkbox","onUpdate:modelValue":h=>t.is_required=h,disabled:s.value},null,8,wa),[[w,t.is_required]]),a[41]||(a[41]=e("span",null,"Wajib",-1))])]),e("button",{type:"button",class:"btn-remove-req",onClick:h=>W(C),disabled:s.value},[u(d(J),{size:"16"})],8,Ta)]))),128))])])]),e("div",Ba,[e("button",{type:"button",class:"btn btn-ghost",onClick:U,disabled:s.value},"Batal",8,Ua),e("button",{type:"submit",class:"btn btn-primary btn-lg",disabled:s.value},[s.value?(n(),i(y,{key:0},[a[42]||(a[42]=e("div",{class:"spinner small"},null,-1)),a[43]||(a[43]=e("span",null,"Menyimpan...",-1))],64)):(n(),i(y,{key:1},[u(d(re),{size:"18"}),e("span",null,c(b.value?"Update Layanan":"Simpan Layanan"),1)],64))],8,Va)])],32)])])):f("",!0)]),_:1})]))}},ja=X(za,[["__scopeId","data-v-315ba13f"]]);export{ja as default};
