import{_ as se,r as u,i as ae,c as n,a as e,d as r,b as _,k as i,v as U,h as N,F as h,n as y,l as te,t as c,e as le,T as oe,j as g,o,x as w,w as $,m as L,q as C,y as z}from"./index-Mv3MxCR1.js";import{S}from"./sweetalert2.esm.all-BQxta0Da.js";import{S as D}from"./search-DW_529iS.js";import{P as ne}from"./plus-BF4bXWAK.js";import{C as ie}from"./chevron-left-C_DfDUMJ.js";import{C as de}from"./chevron-right-u8dkcCrv.js";import{U as F}from"./user-tPY_dJA_.js";import{P as re,T as ce}from"./trash-2-CXOSxmzs.js";import{a as ue,U as ve}from"./user-plus-Cdh2V3rs.js";import{X as K,C as O}from"./x-D8hPaNXE.js";import{M as pe}from"./mail-jA6ul7Ep.js";import{K as j}from"./key-CQufVV6-.js";import{S as me,B as G}from"./shield-check-DjBS79zd.js";import"./createLucideIcon-DBeZuCHW.js";const _e={class:"users-page"},be={class:"header-section"},he={class:"header-actions"},fe={class:"search-wrapper"},xe=["disabled"],ge=["disabled"],ke={class:"card table-card"},ye={key:0,class:"loading-state"},we={key:1,class:"empty-state"},Ce={class:"empty-icon"},Ue={key:2,class:"table-container"},ze={class:"modern-table"},Se={class:"user-info-cell"},Me={class:"flex items-center gap-3"},Ne={class:"avatar-circle"},Ve={class:"flex flex-col"},Te={class:"font-bold text-dark"},qe={class:"text-xs text-muted"},Ae={key:0,class:"text-[10px] text-blue-600 font-bold flex items-center gap-1 mt-0.5"},Be={class:"badges-cell"},$e={class:"flex flex-wrap gap-1"},De={key:0,class:"text-xs text-muted"},Fe={class:"badges-cell"},Pe={class:"flex flex-wrap gap-1"},Ie={key:0,class:"text-xs text-muted"},Re={class:"actions-group"},Je=["onClick","disabled"],Ee=["onClick","disabled"],Le={class:"pagination-footer"},Ke={class:"per-page-selector"},Oe=["disabled"],je={class:"pagination-controls"},Ge={class:"page-info"},He={class:"page-buttons"},Qe=["disabled"],We=["disabled"],Xe={class:"modal-content large"},Ye={class:"modal-header"},Ze={class:"header-icon"},es={class:"header-text"},ss=["disabled"],as={class:"form-grid-main"},ts={class:"form-section"},ls={class:"form-group"},os={class:"input-wrapper"},ns=["disabled"],is={class:"form-group"},ds={class:"input-wrapper"},rs=["disabled"],cs={class:"form-group"},us={class:"form-label"},vs={class:"input-wrapper"},ps=["required","disabled"],ms={class:"form-group mt-4"},_s={class:"selection-box"},bs={class:"box-header"},hs={class:"search-wrapper-inner"},fs={class:"box-content mini-list"},xs={key:0,class:"text-xs text-center py-2"},gs={key:1,class:"text-xs text-center py-2"},ks=["onClick"],ys={class:"flex flex-col"},ws={class:"text-sm font-bold"},Cs={class:"text-[10px] text-muted"},Us={key:2,class:"selected-member-pill"},zs={class:"text-xs text-dark"},Ss={class:"selection-area"},Ms={class:"selection-box"},Ns={class:"box-header"},Vs={class:"box-content checkboxes"},Ts=["value","disabled"],qs={class:"label-text"},As={class:"selection-box mt-4"},Bs={class:"box-header"},$s={class:"box-content checkboxes"},Ds=["value","disabled"],Fs={class:"label-text"},Ps={class:"selection-box mt-4"},Is={class:"box-header"},Rs={class:"box-content checkboxes"},Js=["disabled"],Es=["disabled"],Ls={class:"selection-box mt-4"},Ks={class:"box-header"},Os={class:"box-content checkboxes"},js=["disabled"],Gs={class:"modal-footer"},Hs=["disabled"],Qs=["disabled"],Ws={__name:"Users",setup(Xs){const V=u([]),T=u(!0),d=u(!1),q=u(!1),m=u(null),A=u(""),P=u(null),v=u({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),I=u([]),R=u([]),l=u({name:"",email:"",password:"",roles:[],branches:[],can_request_service:!1,can_approve_service:!1,member_id:null,akses_dashboard:!0}),b=u(""),f=u([]),B=u(!1),k=u(""),J=u(null),x=async(t=1)=>{T.value=!0;try{const s=await g.get("/users",{params:{page:t,per_page:v.value.per_page,search:A.value}});V.value=s.data.data,v.value={current_page:s.data.current_page,last_page:s.data.last_page,per_page:s.data.per_page,total:s.data.total,from:s.data.from,to:s.data.to}}catch(s){console.error("Fetch users failed",s)}finally{T.value=!1}},H=async()=>{try{const[t,s]=await Promise.all([g.get("/roles"),g.get("/branches")]);I.value=t.data,R.value=s.data.data||s.data}catch(t){console.error("Fetch options failed",t)}},Q=()=>{clearTimeout(P.value),P.value=setTimeout(()=>{x(1)},500)};ae(()=>{x(),H()});const E=(t=null)=>{t?(m.value=t.id,l.value={name:t.name,email:t.email,password:"",roles:(t.roles||[]).map(s=>s?.id).filter(s=>s),branches:(t.branches||[]).map(s=>s?.id).filter(s=>s),can_request_service:!!t.can_request_service,can_approve_service:!!t.can_approve_service,member_id:t.member_id,akses_dashboard:t.akses_dashboard!==void 0?!!t.akses_dashboard:!0},k.value=t.member?.nama_lengkap||"",b.value="",f.value=[]):(m.value=null,l.value={name:"",email:"",password:"",roles:[],branches:[],can_request_service:!0,can_approve_service:!1,member_id:null,akses_dashboard:!0},k.value="",b.value="",f.value=[]),q.value=!0},M=()=>{q.value=!1,m.value=null},W=async()=>{d.value=!0;try{const t={...l.value};m.value?(t.password||delete t.password,await g.put(`/users/${m.value}`,t)):await g.post("/users",t),await x(v.value.current_page),M(),S.fire({icon:"success",title:"Success!",text:"User profile has been updated.",timer:2e3,showConfirmButton:!1})}catch(t){const s=t.response?.data?.message||"Failed to save user.";S.fire("Error",s,"error")}finally{d.value=!1}},X=async t=>{if((await S.fire({title:"Delete User?",text:`Are you sure you want to remove ${t.name}? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",confirmButtonText:"Yes, delete account"})).isConfirmed)try{await g.delete(`/users/${t.id}`),await x(v.value.current_page),S.fire("Deleted!","User account has been removed.","success")}catch{S.fire("Error","Failed to delete user.","error")}},Y=()=>{if(!b.value||b.value.length<2){f.value=[];return}clearTimeout(J.value),J.value=setTimeout(async()=>{B.value=!0;try{const t=await g.get("/jemaat",{params:{search:b.value,per_page:5}});f.value=t.data.data||t.data}catch(t){console.error("Jemaat search failed",t)}finally{B.value=!1}},400)},Z=t=>{l.value.member_id=t.id,k.value=t.nama_lengkap,f.value=[],b.value=""},ee=()=>{l.value.member_id=null,k.value=""};return(t,s)=>(o(),n("div",_e,[e("div",be,[s[18]||(s[18]=e("div",{class:"title-group"},[e("h1",{class:"page-title"},"User Management"),e("p",{class:"page-subtitle"},"Manage system users, their access levels and assigned branches")],-1)),e("div",he,[e("div",fe,[r(i(D),{size:"18",class:"search-icon"}),_(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>A.value=a),type:"text",placeholder:"Search users...",class:"search-input",onInput:Q,disabled:d.value},null,40,xe),[[U,A.value]])]),e("button",{class:"btn btn-primary",onClick:s[1]||(s[1]=a=>E()),disabled:d.value},[r(i(ne),{size:"18"}),s[16]||(s[16]=N()),s[17]||(s[17]=e("span",null,"Add User",-1))],8,ge)])]),e("div",ke,[T.value?(o(),n("div",ye,[...s[19]||(s[19]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading user directory...",-1)])])):V.value.length===0?(o(),n("div",we,[e("div",Ce,[r(i(D),{size:"48"})]),s[20]||(s[20]=e("p",null,"No users match your criteria.",-1))])):(o(),n("div",Ue,[e("table",ze,[s[21]||(s[21]=e("thead",null,[e("tr",null,[e("th",null,"User Info"),e("th",null,"Roles"),e("th",null,"Branches"),e("th",{class:"text-right"},"Actions")])],-1)),e("tbody",null,[(o(!0),n(h,null,y(V.value,a=>(o(),n("tr",{key:a.id,class:"row-hover"},[e("td",Se,[e("div",Me,[e("div",Ne,c(a.name.charAt(0).toUpperCase()),1),e("div",Ve,[e("span",Te,c(a.name),1),e("span",qe,c(a.email),1),a.member?(o(),n("span",Ae,[r(i(F),{size:"10"}),N(" Member: "+c(a.member.nama_lengkap),1)])):w("",!0)])])]),e("td",Be,[e("div",$e,[(o(!0),n(h,null,y(a.roles,p=>(o(),n("span",{key:p.id,class:"badge-pill role"},c(p.name),1))),128)),a.roles?.length?w("",!0):(o(),n("span",De,"No roles"))])]),e("td",Fe,[e("div",Pe,[(o(!0),n(h,null,y(a.branches,p=>(o(),n("span",{key:p.id,class:"badge-pill branch"},c(p.name),1))),128)),a.branches?.length?w("",!0):(o(),n("span",Ie,"No branches"))])]),e("td",null,[e("div",Re,[e("button",{class:"action-btn edit",onClick:p=>E(a),title:"Edit User",disabled:d.value},[r(i(re),{size:"16"})],8,Je),e("button",{class:"action-btn delete",onClick:p=>X(a),title:"Delete User",disabled:d.value},[r(i(ce),{size:"16"})],8,Ee)])])]))),128))])]),e("div",Le,[e("div",Ke,[s[23]||(s[23]=e("span",{class:"text-xs font-bold text-muted"},"SHOWING",-1)),_(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>v.value.per_page=a),onChange:s[3]||(s[3]=a=>x(1)),disabled:d.value},[...s[22]||(s[22]=[e("option",{value:10},"10 entries",-1),e("option",{value:25},"25 entries",-1),e("option",{value:50},"50 entries",-1),e("option",{value:100},"100 entries",-1)])],40,Oe),[[te,v.value.per_page]])]),e("div",je,[e("span",Ge,[e("b",null,c(v.value.from||0)+"-"+c(v.value.to||0),1),s[24]||(s[24]=N(" of ",-1)),e("b",null,c(v.value.total),1)]),e("div",He,[e("button",{class:"page-btn",disabled:v.value.current_page===1||d.value,onClick:s[4]||(s[4]=a=>x(v.value.current_page-1))},[r(i(ie),{size:"18"})],8,Qe),e("button",{class:"page-btn",disabled:v.value.current_page===v.value.last_page||d.value,onClick:s[5]||(s[5]=a=>x(v.value.current_page+1))},[r(i(de),{size:"18"})],8,We)])])])]))]),r(oe,{name:"modal-fade"},{default:le(()=>[q.value?(o(),n("div",{key:0,class:"modal-overlay",onClick:s[15]||(s[15]=$(a=>!d.value&&M(),["self"]))},[e("div",Xe,[e("div",Ye,[e("div",Ze,[m.value?(o(),L(i(ve),{key:1,size:"24"})):(o(),L(i(ue),{key:0,size:"24"}))]),e("div",es,[e("h2",null,c(m.value?"Update Account":"New User Account"),1),e("p",null,c(m.value?"Modify credentials and access for this user":"Fill in the information below to create a new user profile"),1)]),e("button",{class:"close-btn",onClick:M,disabled:d.value},[r(i(K),{size:"20"})],8,ss)]),e("form",{onSubmit:$(W,["prevent"]),class:"modal-body"},[e("div",as,[e("div",ts,[e("div",ls,[s[25]||(s[25]=e("label",{class:"form-label"},"Full Name",-1)),e("div",os,[r(i(F),{size:"18",class:"input-icon"}),_(e("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>l.value.name=a),type:"text",required:"",placeholder:"Full Name",disabled:d.value},null,8,ns),[[U,l.value.name]])])]),e("div",is,[s[26]||(s[26]=e("label",{class:"form-label"},"Email Address",-1)),e("div",ds,[r(i(pe),{size:"18",class:"input-icon"}),_(e("input",{"onUpdate:modelValue":s[7]||(s[7]=a=>l.value.email=a),type:"email",required:"",placeholder:"email@example.com",disabled:d.value},null,8,rs),[[U,l.value.email]])])]),e("div",cs,[e("label",us,c(m.value?"New Password (Optional)":"Default Password"),1),e("div",vs,[r(i(j),{size:"18",class:"input-icon"}),_(e("input",{"onUpdate:modelValue":s[8]||(s[8]=a=>l.value.password=a),type:"password",required:!m.value,placeholder:"••••••••",disabled:d.value},null,8,ps),[[U,l.value.password]])])]),e("div",ms,[s[29]||(s[29]=e("label",{class:"form-label"},"Linked Jemaat Member",-1)),e("div",_s,[e("div",bs,[r(i(F),{size:"16"}),s[27]||(s[27]=e("span",null,"Search Member",-1))]),e("div",hs,[_(e("input",{type:"text","onUpdate:modelValue":s[9]||(s[9]=a=>b.value=a),onInput:Y,placeholder:"Type name or NIK...",class:"search-input-small"},null,544),[[U,b.value]]),r(i(D),{size:"14",class:"search-icon-small"})]),e("div",fs,[B.value?(o(),n("div",xs,"Searching...")):f.value.length===0&&b.value.length>=2?(o(),n("div",gs,"No members found")):w("",!0),(o(!0),n(h,null,y(f.value,a=>(o(),n("div",{key:a.id,class:C(["jemaat-option",{selected:l.value.member_id===a.id}]),onClick:p=>Z(a)},[e("div",ys,[e("span",ws,c(a.nama_lengkap),1),e("span",Cs,"NIK: "+c(a.nik),1)])],10,ks))),128)),k.value?(o(),n("div",Us,[r(i(O),{size:"12",class:"text-green-500"}),e("span",zs,[s[28]||(s[28]=N("Linked: ",-1)),e("b",null,c(k.value),1)]),e("button",{type:"button",class:"clear-selection",onClick:$(ee,["stop"])},[r(i(K),{size:"12"})])])):w("",!0)])])])]),e("div",Ss,[e("div",Ms,[e("div",Ns,[r(i(me),{size:"16"}),s[30]||(s[30]=e("span",null,"Assign Roles",-1))]),e("div",Vs,[(o(!0),n(h,null,y(I.value,a=>(o(),n("label",{key:a?.id,class:C(["checkbox-item",{selected:l.value.roles.includes(a?.id)}])},[_(e("input",{type:"checkbox",value:a?.id,"onUpdate:modelValue":s[10]||(s[10]=p=>l.value.roles=p),disabled:d.value},null,8,Ts),[[z,l.value.roles]]),e("span",qs,c(a?.name),1)],2))),128))])]),e("div",As,[e("div",Bs,[r(i(G),{size:"16"}),s[31]||(s[31]=e("span",null,"Branch Access",-1))]),e("div",$s,[(o(!0),n(h,null,y(R.value,a=>(o(),n("label",{key:a?.id,class:C(["checkbox-item",{selected:l.value.branches.includes(a?.id)}])},[_(e("input",{type:"checkbox",value:a?.id,"onUpdate:modelValue":s[11]||(s[11]=p=>l.value.branches=p),disabled:d.value},null,8,Ds),[[z,l.value.branches]]),e("span",Fs,c(a?.name),1)],2))),128))])]),e("div",Ps,[e("div",Is,[r(i(j),{size:"16"}),s[32]||(s[32]=e("span",null,"Service Permissions",-1))]),e("div",Rs,[e("label",{class:C(["checkbox-item",{selected:l.value.can_request_service}])},[_(e("input",{type:"checkbox","onUpdate:modelValue":s[12]||(s[12]=a=>l.value.can_request_service=a),disabled:d.value},null,8,Js),[[z,l.value.can_request_service]]),s[33]||(s[33]=e("span",{class:"label-text"},"Can Request Service",-1))],2),e("label",{class:C(["checkbox-item",{selected:l.value.can_approve_service}])},[_(e("input",{type:"checkbox","onUpdate:modelValue":s[13]||(s[13]=a=>l.value.can_approve_service=a),disabled:d.value},null,8,Es),[[z,l.value.can_approve_service]]),s[34]||(s[34]=e("span",{class:"label-text"},"Can Approve Service",-1))],2)])]),e("div",Ls,[e("div",Ks,[r(i(G),{size:"16"}),s[35]||(s[35]=e("span",null,"Dashboard Access",-1))]),e("div",Os,[e("label",{class:C(["checkbox-item",{selected:l.value.akses_dashboard}])},[_(e("input",{type:"checkbox","onUpdate:modelValue":s[14]||(s[14]=a=>l.value.akses_dashboard=a),disabled:d.value},null,8,js),[[z,l.value.akses_dashboard]]),s[36]||(s[36]=e("span",{class:"label-text"},"Allow Dashboard Access",-1))],2)])])])]),e("div",Gs,[e("button",{type:"button",class:"btn btn-ghost",onClick:M,disabled:d.value},"Cancel",8,Hs),e("button",{type:"submit",class:"btn btn-primary btn-lg",disabled:d.value},[d.value?(o(),n(h,{key:0},[s[37]||(s[37]=e("div",{class:"spinner small"},null,-1)),s[38]||(s[38]=e("span",null,"Saving...",-1))],64)):(o(),n(h,{key:1},[r(i(O),{size:"18"}),e("span",null,c(m.value?"Update User":"Register User"),1)],64))],8,Qs)])],32)])])):w("",!0)]),_:1})]))}},va=se(Ws,[["__scopeId","data-v-e764ca8e"]]);export{va as default};
