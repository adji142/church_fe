import{_ as K,r as m,z as O,i as W,c as a,a as e,d as c,b as E,k as r,v as j,h as Z,F as u,n as f,e as ee,T as se,j as x,o as l,t as p,x as y,w as I,m as Q,q as k,y as te}from"./index-Mv3MxCR1.js";import{S as C}from"./sweetalert2.esm.all-BQxta0Da.js";import{S as X}from"./search-DW_529iS.js";import{P as le}from"./plus-BF4bXWAK.js";import{P as Y,T as ae}from"./trash-2-CXOSxmzs.js";import{S as oe,L as ne}from"./shield-DrF0aZEA.js";import{X as ie,C as de}from"./x-D8hPaNXE.js";import{T as re}from"./type-zrf9LQ7g.js";import{P as ce}from"./panels-top-left-B1iGkGEJ.js";import{C as G}from"./chevron-down-DSZpuO8w.js";import"./createLucideIcon-DBeZuCHW.js";const ue={class:"roles-page"},ve={class:"header-section"},me={class:"header-actions"},pe={class:"search-wrapper"},he=["disabled"],_e=["disabled"],be={class:"card table-card"},fe={key:0,class:"loading-state"},ye={key:1,class:"empty-state"},xe={class:"empty-icon"},ke={key:2,class:"table-container"},ge={class:"modern-table"},Ce={class:"role-name-cell"},we={class:"flex items-center gap-3"},Re={class:"font-bold"},Se={class:"badges-cell"},ze={class:"flex flex-wrap gap-1"},Me={key:0,class:"text-xs text-muted"},Te={class:"badges-cell"},Ne={class:"flex flex-wrap gap-1"},De={key:0,class:"text-xs text-muted"},Pe={class:"actions-group"},Ae=["onClick","disabled"],Be=["onClick","disabled"],$e={class:"modal-content large"},Ee={class:"modal-header"},Le={class:"header-icon"},Ve={class:"header-text"},Fe=["disabled"],Ue={class:"form-section"},qe={class:"form-group full-width"},je={class:"input-wrapper"},Ie=["disabled"],Qe={class:"selection-grid"},Xe={class:"selection-box"},Ye={class:"box-header"},Ge={class:"box-content checkboxes"},He=["value","disabled"],Je={class:"label-text"},Ke={key:0,class:"text-xs text-muted p-4"},Oe={class:"selection-box"},We={class:"box-header"},Ze={class:"box-content hierarchical"},es={class:"tree-item parent"},ss=["onClick"],ts={key:1,class:"expand-spacer"},ls=["checked","onChange","disabled"],as={class:"label-text font-bold text-slate-800"},os={class:"tree-item child pl-10"},ns=["onClick"],is={key:1,class:"expand-spacer small"},ds=["checked","onChange","disabled"],rs={class:"label-text font-semibold"},cs=["checked","onChange","disabled"],us={class:"label-text text-slate-500"},vs={key:0,class:"text-xs text-muted p-4"},ms={class:"modal-footer"},ps=["disabled"],hs=["disabled"],_s={__name:"Roles",setup(bs){const T=m([]),N=m(!0),d=m(!1),D=m(!1),_=m(null),w=m(""),P=m([]),R=m([]),h=m(new Set),i=m({name:"",permissions:[],menus:[]}),L=n=>{h.value.has(n)?h.value.delete(n):h.value.add(n),h.value=new Set(h.value)},A=(n,s)=>{const t=new Set(i.value.menus),o=(b,g)=>{g?t.add(b.id):t.delete(b.id),b.children&&b.children.forEach(z=>o(z,g))},v=b=>{const g=[],z=($,U,q=[])=>{for(const M of $){if(M.id===U)return g.push(...q),!0;if(M.children&&z(M.children,U,[...q,M.id]))return!0}return!1};z(R.value,b),g.forEach($=>t.add($))};o(n,s),s&&v(n.id),i.value.menus=Array.from(t)},B=async()=>{N.value=!0;try{const[n,s,t]=await Promise.all([x.get("/roles"),x.get("/permissions"),x.get("/menus-tree")]);T.value=n.data,P.value=s.data,R.value=t.data}catch(n){console.error("Failed to fetch data",n)}finally{N.value=!1}},V=O(()=>{if(!w.value)return T.value;const n=w.value.toLowerCase();return T.value.filter(s=>s.name.toLowerCase().includes(n))});W(B);const F=(n=null)=>{n?(_.value=n.id,i.value={name:n.name,permissions:n.permissions.map(s=>s.id),menus:n.menus.map(s=>s.id)}):(_.value=null,i.value={name:"",permissions:[],menus:[]}),D.value=!0},S=()=>{D.value=!1},H=async()=>{d.value=!0;try{_.value?await x.put(`/roles/${_.value}`,i.value):await x.post("/roles",i.value),await B(),S(),C.fire({icon:"success",title:"Success!",text:"Role settings have been updated.",timer:2e3,showConfirmButton:!1})}catch{C.fire("Error","Failed to save role configuration.","error")}finally{d.value=!1}},J=async n=>{if((await C.fire({title:"Are you sure?",text:"This action will revoke access for all users assigned to this role!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await x.delete(`/roles/${n}`),await B(),C.fire("Deleted!","The role has been removed.","success")}catch{C.fire("Error","Failed to delete role.","error")}};return(n,s)=>(l(),a("div",ue,[e("div",ve,[s[7]||(s[7]=e("div",{class:"title-group"},[e("h1",{class:"page-title"},"Role Management"),e("p",{class:"page-subtitle"},"Configure system roles, permissions, and menu accessibility")],-1)),e("div",me,[e("div",pe,[c(r(X),{size:"18",class:"search-icon"}),E(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>w.value=t),type:"text",placeholder:"Search roles...",class:"search-input",disabled:d.value},null,8,he),[[j,w.value]])]),e("button",{class:"btn btn-primary",onClick:s[1]||(s[1]=t=>F()),disabled:d.value},[c(r(le),{size:"18"}),s[5]||(s[5]=Z()),s[6]||(s[6]=e("span",null,"Add Role",-1))],8,_e)])]),e("div",be,[N.value?(l(),a("div",fe,[...s[8]||(s[8]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading roles and permissions...",-1)])])):V.value.length===0?(l(),a("div",ye,[e("div",xe,[c(r(X),{size:"48"})]),s[9]||(s[9]=e("p",null,"No roles found matching your search.",-1))])):(l(),a("div",ke,[e("table",ge,[s[11]||(s[11]=e("thead",null,[e("tr",null,[e("th",{style:{width:"200px"}},"Role Name"),e("th",null,"Permissions"),e("th",null,"Menu Access"),e("th",{class:"text-right"},"Actions")])],-1)),e("tbody",null,[(l(!0),a(u,null,f(V.value,t=>(l(),a("tr",{key:t.id,class:"row-hover"},[e("td",Ce,[e("div",we,[s[10]||(s[10]=e("div",{class:"status-indicator"},null,-1)),e("span",Re,p(t.name),1)])]),e("td",Se,[e("div",ze,[(l(!0),a(u,null,f(t.permissions,o=>(l(),a("span",{key:o.id,class:"badge-pill permission"},p(o.name),1))),128)),t.permissions?.length?y("",!0):(l(),a("span",Me,"No permissions"))])]),e("td",Te,[e("div",Ne,[(l(!0),a(u,null,f(t.menus,o=>(l(),a("span",{key:o.id,class:"badge-pill menu"},p(o.title),1))),128)),t.menus?.length?y("",!0):(l(),a("span",De,"No menus"))])]),e("td",null,[e("div",Pe,[e("button",{class:"action-btn edit",onClick:o=>F(t),title:"Edit Role",disabled:d.value},[c(r(Y),{size:"16"})],8,Ae),e("button",{class:"action-btn delete",onClick:o=>J(t.id),title:"Delete Role",disabled:d.value},[c(r(ae),{size:"16"})],8,Be)])])]))),128))])])]))]),c(se,{name:"modal-fade"},{default:ee(()=>[D.value?(l(),a("div",{key:0,class:"modal-overlay",onClick:s[4]||(s[4]=I(t=>!d.value&&S(),["self"]))},[e("div",$e,[e("div",Ee,[e("div",Le,[_.value?(l(),Q(r(Y),{key:1,size:"24"})):(l(),Q(r(oe),{key:0,size:"24"}))]),e("div",Ve,[e("h2",null,p(_.value?"Update Role":"Create New Role"),1),e("p",null,p(_.value?"Modify existing system permissions and access":"Define new access levels for system users"),1)]),e("button",{class:"close-btn",onClick:S,disabled:d.value},[c(r(ie),{size:"20"})],8,Fe)]),e("form",{onSubmit:I(H,["prevent"]),class:"modal-body"},[e("div",Ue,[e("div",qe,[s[12]||(s[12]=e("label",{class:"form-label"},"Role Name",-1)),e("div",je,[c(r(re),{size:"18",class:"input-icon"}),E(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>i.value.name=t),type:"text",required:"",placeholder:"Display name (e.g. System Admin)",disabled:d.value},null,8,Ie),[[j,i.value.name]])])]),e("div",Qe,[e("div",Xe,[e("div",Ye,[c(r(ne),{size:"16"}),s[13]||(s[13]=e("span",null,"Permissions",-1))]),e("div",Ge,[(l(!0),a(u,null,f(P.value,t=>(l(),a("label",{key:t.id,class:k(["checkbox-item",{selected:i.value.permissions.includes(t.id)}])},[E(e("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":s[3]||(s[3]=o=>i.value.permissions=o),disabled:d.value},null,8,He),[[te,i.value.permissions]]),e("span",Je,p(t.name),1)],2))),128)),P.value.length?y("",!0):(l(),a("div",Ke,"No permissions available"))])]),e("div",Oe,[e("div",We,[c(r(ce),{size:"16"}),s[14]||(s[14]=e("span",null,"Menu Accessibility",-1))]),e("div",Ze,[(l(!0),a(u,null,f(R.value,t=>(l(),a(u,{key:t.id},[e("div",es,[t.children?.length?(l(),a("button",{key:0,type:"button",class:"expand-toggle",onClick:o=>L(t.id)},[c(r(G),{size:"14",class:k({"rotate-n90":!h.value.has(t.id)})},null,8,["class"])],8,ss)):(l(),a("div",ts)),e("label",{class:k(["checkbox-item",{selected:i.value.menus.includes(t.id)}])},[e("input",{type:"checkbox",checked:i.value.menus.includes(t.id),onChange:o=>A(t,o.target.checked),disabled:d.value},null,40,ls),e("span",as,p(t.title),1)],2)]),h.value.has(t.id)?(l(!0),a(u,{key:0},f(t.children,o=>(l(),a(u,{key:o.id},[e("div",os,[o.children?.length?(l(),a("button",{key:0,type:"button",class:"expand-toggle",onClick:v=>L(o.id)},[c(r(G),{size:"12",class:k({"rotate-n90":!h.value.has(o.id)})},null,8,["class"])],8,ns)):(l(),a("div",is)),e("label",{class:k(["checkbox-item",{selected:i.value.menus.includes(o.id)}])},[e("input",{type:"checkbox",checked:i.value.menus.includes(o.id),onChange:v=>A(o,v.target.checked),disabled:d.value},null,40,ds),e("span",rs,p(o.title),1)],2)]),h.value.has(o.id)?(l(!0),a(u,{key:0},f(o.children,v=>(l(),a("div",{key:v.id,class:"tree-item grandchild pl-20"},[s[15]||(s[15]=e("div",{class:"expand-spacer smaller"},null,-1)),e("label",{class:k(["checkbox-item",{selected:i.value.menus.includes(v.id)}])},[e("input",{type:"checkbox",checked:i.value.menus.includes(v.id),onChange:b=>A(v,b.target.checked),disabled:d.value},null,40,cs),e("span",us,p(v.title),1)],2)]))),128)):y("",!0)],64))),128)):y("",!0)],64))),128)),R.value.length?y("",!0):(l(),a("div",vs,"No menus available"))])])])]),e("div",ms,[e("button",{type:"button",class:"btn btn-ghost",onClick:S,disabled:d.value},"Discard",8,ps),e("button",{type:"submit",class:"btn btn-primary btn-lg",disabled:d.value},[d.value?(l(),a(u,{key:0},[s[16]||(s[16]=e("div",{class:"spinner small"},null,-1)),s[17]||(s[17]=e("span",null,"Saving Changes...",-1))],64)):(l(),a(u,{key:1},[c(r(de),{size:"18"}),e("span",null,p(_.value?"Update Role":"Confirm & Save"),1)],64))],8,hs)])],32)])])):y("",!0)]),_:1})]))}},Ts=K(_s,[["__scopeId","data-v-a4f3c0d3"]]);export{Ts as default};
