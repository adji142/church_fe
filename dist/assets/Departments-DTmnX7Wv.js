import{_ as G,u as K,r as p,A as H,i as j,c as i,a as e,d,b as h,k as r,v as D,h as M,F as k,n as S,l as A,t as c,e as q,T as O,j as f,o,x as Q,w as $,m as U}from"./index-Mv3MxCR1.js";import{S as b}from"./sweetalert2.esm.all-BQxta0Da.js";import{S as V}from"./search-DW_529iS.js";import{P as N}from"./plus-BF4bXWAK.js";import{C as X}from"./chevron-left-C_DfDUMJ.js";import{C as Y}from"./chevron-right-u8dkcCrv.js";import{P,T as J}from"./trash-2-CXOSxmzs.js";import{X as W,C as Z}from"./x-D8hPaNXE.js";import{T as ee}from"./type-zrf9LQ7g.js";import{L as ae}from"./layers-ChaLHLIF.js";import"./createLucideIcon-DBeZuCHW.js";const te={class:"master-data-page wide"},se={class:"header-section"},le={class:"header-actions"},ne={class:"search-wrapper"},oe=["disabled"],ie=["disabled"],re={class:"card table-card"},de={key:0,class:"loading-state"},ue={key:1,class:"empty-state"},pe={class:"empty-icon"},ce={key:2,class:"table-container"},ve={class:"modern-table"},me={class:"order-badge"},be={class:"font-bold text-dark"},_e={key:0,class:"parent-tag"},he={key:1,class:"text-muted text-xs italic"},fe={class:"actions-group"},ge=["onClick","disabled"],ke=["onClick","disabled"],ye={class:"pagination-footer"},we={class:"per-page-selector"},xe=["disabled"],Ce={class:"pagination-controls"},De={class:"page-info"},Be={class:"page-buttons"},Te=["disabled"],ze=["disabled"],Me={class:"modal-content"},Se={class:"modal-header"},Ae={class:"header-icon"},$e={class:"header-text"},Ue=["disabled"],Ve={class:"form-section"},Ne={class:"form-group full-width"},Pe={class:"input-wrapper"},Ie=["disabled"],Ee={class:"form-group full-width"},Le={class:"input-wrapper"},Re=["disabled"],Fe=["value","disabled"],Ge={class:"form-group full-width"},Ke={class:"input-wrapper"},He=["disabled"],je={class:"modal-footer"},qe=["disabled"],Oe=["disabled"],Qe={__name:"Departments",setup(Xe){const _=K(),y=p([]),B=p([]),w=p(!0),s=p(!1),x=p(!1),v=p(null),C=p(""),T=p(null),l=p({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),u=p({name:"",parent_id:null,description:"",branch_id:null}),m=async(n=1)=>{if(_.activeBranch){w.value=!0;try{const[a,t]=await Promise.all([f.get("/departments",{params:{branch_id:_.activeBranch.id,page:n,per_page:l.value.per_page,search:C.value}}),f.get("/departments",{params:{branch_id:_.activeBranch.id,per_page:999}})]);y.value=a.data.data,l.value={current_page:a.data.current_page,last_page:a.data.last_page,per_page:a.data.per_page,total:a.data.total,from:a.data.from,to:a.data.to},B.value=t.data.data}catch(a){console.error("Failed to fetch departments",a),b.fire("Error","Gagal memuat data departemen.","error")}finally{w.value=!1}}},I=()=>{clearTimeout(T.value),T.value=setTimeout(()=>{m(1)},500)};H(()=>_.activeBranch,n=>{n&&m(1)},{immediate:!0}),j(()=>{m()});const z=(n=null)=>{n?(v.value=n.id,u.value={name:n.name,parent_id:n.parent_id,description:n.description,branch_id:n.branch_id}):(v.value=null,u.value={name:"",parent_id:null,description:"",branch_id:_.activeBranch?.id}),x.value=!0},g=()=>{x.value=!1},E=async()=>{if(!u.value.branch_id){b.fire("Error","Silakan pilih cabang terlebih dahulu.","error");return}s.value=!0;try{v.value?await f.put(`/departments/${v.value}`,u.value):await f.post("/departments",u.value),await m(l.value.current_page),g(),b.fire({icon:"success",title:"Berhasil!",text:"Data departemen telah diperbarui.",timer:2e3,showConfirmButton:!1})}catch{b.fire("Error","Gagal menyimpan data.","error")}finally{s.value=!1}},L=async n=>{if((await b.fire({title:"Apakah Anda yakin?",text:`Departemen "${n.name}" akan dihapus permanen!`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"})).isConfirmed)try{await f.delete(`/departments/${n.id}`),await m(l.value.current_page),b.fire("Dihapus!","Data telah berhasil dihapus.","success")}catch{b.fire("Error","Gagal menghapus data.","error")}};return(n,a)=>(o(),i("div",te,[e("div",se,[a[12]||(a[12]=e("div",{class:"title-group"},[e("h1",{class:"page-title"},"Master Departemen"),e("p",{class:"page-subtitle"},"Kelola struktur departemen organisasi di cabang ini")],-1)),e("div",le,[e("div",ne,[d(r(V),{size:"18",class:"search-icon"}),h(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>C.value=t),type:"text",placeholder:"Cari departemen...",class:"search-input",onInput:I,disabled:s.value},null,40,oe),[[D,C.value]])]),e("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=t=>z()),disabled:s.value},[d(r(N),{size:"18"}),a[10]||(a[10]=M()),a[11]||(a[11]=e("span",null,"Tambah Departemen",-1))],8,ie)])]),e("div",re,[w.value?(o(),i("div",de,[...a[13]||(a[13]=[e("div",{class:"spinner"},null,-1),e("p",null,"Memuat data...",-1)])])):y.value.length===0?(o(),i("div",ue,[e("div",pe,[d(r(V),{size:"48"})]),a[14]||(a[14]=e("p",null,"Tidak ada data yang ditemukan.",-1))])):(o(),i("div",ce,[e("table",ve,[a[15]||(a[15]=e("thead",null,[e("tr",null,[e("th",{style:{width:"80px"}},"No"),e("th",null,"Nama Departemen"),e("th",null,"Induk (Parent)"),e("th",{class:"text-right"},"Aksi")])],-1)),e("tbody",null,[(o(!0),i(k,null,S(y.value,(t,R)=>(o(),i("tr",{key:t.id,class:"row-hover"},[e("td",null,[e("span",me,c(l.value.from+R),1)]),e("td",be,c(t.name),1),e("td",null,[t.parent?(o(),i("span",_e,c(t.parent.name),1)):(o(),i("span",he,"Akar (Root)"))]),e("td",null,[e("div",fe,[e("button",{class:"action-btn edit",onClick:F=>z(t),title:"Ubah",disabled:s.value},[d(r(P),{size:"16"})],8,ge),e("button",{class:"action-btn delete",onClick:F=>L(t),title:"Hapus",disabled:s.value},[d(r(J),{size:"16"})],8,ke)])])]))),128))])]),e("div",ye,[e("div",we,[a[17]||(a[17]=e("span",{class:"text-xs font-bold text-muted"},"TAMPILKAN",-1)),h(e("select",{"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.per_page=t),onChange:a[3]||(a[3]=t=>m(1)),disabled:s.value},[...a[16]||(a[16]=[e("option",{value:10},"10 data",-1),e("option",{value:25},"25 data",-1),e("option",{value:50},"50 data",-1),e("option",{value:100},"100 data",-1)])],40,xe),[[A,l.value.per_page]])]),e("div",Ce,[e("span",De,[e("b",null,c(l.value.from||0)+"-"+c(l.value.to||0),1),a[18]||(a[18]=M(" dari ",-1)),e("b",null,c(l.value.total),1)]),e("div",Be,[e("button",{class:"page-btn",disabled:l.value.current_page===1||s.value,onClick:a[4]||(a[4]=t=>m(l.value.current_page-1))},[d(r(X),{size:"18"})],8,Te),e("button",{class:"page-btn",disabled:l.value.current_page===l.value.last_page||s.value,onClick:a[5]||(a[5]=t=>m(l.value.current_page+1))},[d(r(Y),{size:"18"})],8,ze)])])])]))]),d(O,{name:"modal-fade"},{default:q(()=>[x.value?(o(),i("div",{key:0,class:"modal-overlay",onClick:a[9]||(a[9]=$(t=>!s.value&&g(),["self"]))},[e("div",Me,[e("div",Se,[e("div",Ae,[v.value?(o(),U(r(P),{key:1,size:"24"})):(o(),U(r(N),{key:0,size:"24"}))]),e("div",$e,[e("h2",null,c(v.value?"Update Departemen":"Tambah Departemen Baru"),1),e("p",null,c(v.value?"Ubah informasi departemen yang sudah ada":"Masukkan nama departemen baru"),1)]),e("button",{class:"close-btn",onClick:g,disabled:s.value},[d(r(W),{size:"20"})],8,Ue)]),e("form",{onSubmit:$(E,["prevent"]),class:"modal-body"},[e("div",Ve,[e("div",Ne,[a[19]||(a[19]=e("label",{class:"form-label"},"Nama Departemen",-1)),e("div",Pe,[d(r(ee),{size:"18",class:"input-icon"}),h(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>u.value.name=t),type:"text",required:"",placeholder:"Contoh: Departemen Musik, Pemuda, dll.",disabled:s.value},null,8,Ie),[[D,u.value.name]])])]),e("div",Ee,[a[21]||(a[21]=e("label",{class:"form-label"},"Departemen Induk (Opsional)",-1)),e("div",Le,[d(r(ae),{size:"18",class:"input-icon"}),h(e("select",{"onUpdate:modelValue":a[7]||(a[7]=t=>u.value.parent_id=t),disabled:s.value},[a[20]||(a[20]=e("option",{value:null},"-- Tidak Ada (Sebagai Akar) --",-1)),(o(!0),i(k,null,S(B.value,t=>(o(),i("option",{key:t.id,value:t.id,disabled:t.id===v.value},c(t.name),9,Fe))),128))],8,Re),[[A,u.value.parent_id]])])]),e("div",Ge,[a[22]||(a[22]=e("label",{class:"form-label"},"Keterangan",-1)),e("div",Ke,[h(e("textarea",{"onUpdate:modelValue":a[8]||(a[8]=t=>u.value.description=t),rows:"3",placeholder:"Informasi tambahan...",disabled:s.value,class:"modern-textarea"},null,8,He),[[D,u.value.description]])])])]),e("div",je,[e("button",{type:"button",class:"btn btn-ghost",onClick:g,disabled:s.value},"Batal",8,qe),e("button",{type:"submit",class:"btn btn-primary btn-lg",disabled:s.value},[s.value?(o(),i(k,{key:0},[a[23]||(a[23]=e("div",{class:"spinner small"},null,-1)),a[24]||(a[24]=e("span",null,"Menyimpan...",-1))],64)):(o(),i(k,{key:1},[d(r(Z),{size:"18"}),e("span",null,c(v.value?"Update Departemen":"Simpan Departemen"),1)],64))],8,Oe)])],32)])])):Q("",!0)]),_:1})]))}},ia=G(Qe,[["__scopeId","data-v-34516fbf"]]);export{ia as default};
