import{_ as V,u as R,r as c,i as F,c as l,a as e,k as i,g as I,d as r,w as N,x as _,b as f,v as w,e as U,T as A,t as m,l as z,F as g,n as q,q as E,j as C,o as n}from"./index-Mv3MxCR1.js";import{S as y}from"./sweetalert2.esm.all-BQxta0Da.js";import{A as $}from"./arrow-left-Cam99NkQ.js";import{F as K}from"./file-plus-DZn6GRqB.js";import{S as O}from"./search-DW_529iS.js";import{C as J}from"./circle-check-big-BN4MHkMS.js";import{X as G,C as H}from"./x-D8hPaNXE.js";import{T as X}from"./type-zrf9LQ7g.js";import{C as Q}from"./calendar-COvuOzBD.js";import{L as W}from"./layers-ChaLHLIF.js";import{F as Y}from"./file-text-CPaFxqa6.js";import"./createLucideIcon-DBeZuCHW.js";const Z={class:"master-data-page"},ee={class:"header-section"},se={class:"header-left"},ae={class:"form-container-centered"},te={class:"form-section"},ie={class:"section-header"},oe={class:"header-icon-small"},le={class:"form-group full-width"},ne={key:0,class:"autocomplete-wrapper"},re={class:"input-wrapper"},de=["disabled"],ue={key:0,class:"autocomplete-results"},ce=["onClick"],me={class:"item-main"},pe={class:"font-bold text-dark"},ve={class:"badge-nik"},_e={class:"text-xs text-muted"},fe={key:1,class:"selected-member-card"},be={class:"check-icon"},he={class:"member-info"},ge={class:"member-name"},ye={class:"member-sub"},ke={class:"form-group full-width mt-4"},we={class:"input-wrapper"},Ce=["disabled"],Se=["value"],xe={class:"form-group"},Te={class:"input-wrapper"},Be=["disabled"],ze={key:0,class:"form-group"},qe={class:"input-wrapper"},Pe=["disabled"],Le={class:"form-group full-width mt-4"},Me={class:"input-wrapper"},je=["disabled"],De={class:"form-footer"},Ve=["disabled"],Re=["disabled"],Fe={__name:"CreateServiceRequest",setup(Ie){const d=R(),k=I(),S=c([]),v=c(""),b=c([]),h=c(!1),p=c(null),x=c(null),u=c(!1),T=new Date,P=T.getTimezoneOffset()*6e4,L=new Date(T-P).toISOString().slice(0,16),o=c({service_type_id:"",member_id:"",status:"pending",requested_at:L,notes:""}),M=async()=>{try{const t=await C.get("/service-types",{params:{church_id:d.activeBranch.id,is_active:1,per_page:100}});S.value=t.data.data}catch(t){console.error(t)}},j=()=>{if(v.value.length<2){b.value=[],h.value=!1;return}clearTimeout(x.value),x.value=setTimeout(async()=>{try{const t=await C.get("/jemaat",{params:{church_id:d.activeBranch.id,search:v.value,per_page:5}});b.value=t.data.data,h.value=!0}catch(t){console.error(t)}},400)},B=t=>{p.value=t,o.value.member_id=t.id,v.value=t.nama_lengkap,h.value=!1},D=async()=>{if(!o.value.member_id){y.fire("Error","Pilih jemaat terlebih dahulu","error");return}if(!o.value.service_type_id){y.fire("Error","Pilih jenis layanan","error");return}u.value=!0;try{const t={...o.value,church_id:d.activeBranch.id},s=await C.post("/service-requests",t);y.fire({icon:"success",title:"Berhasil",text:"Permintaan layanan dibuat",showConfirmButton:!1,timer:1500}),k.push({name:"ServiceRequestDetail",params:{id:s.data.id}})}catch(t){console.error(t),y.fire("Error","Gagal membuat permintaan","error")}finally{u.value=!1}};return F(()=>{d.activeBranch&&M(),!d.user?.can_approve_service&&d.user?.member&&B(d.user.member)}),(t,s)=>(n(),l("div",Z,[e("div",ee,[e("div",se,[e("button",{class:"back-btn",onClick:s[0]||(s[0]=a=>i(k).back())},[r(i($),{size:"20"})]),s[8]||(s[8]=e("div",{class:"title-group"},[e("h1",{class:"page-title"},"Buat Permintaan Layanan"),e("p",{class:"page-subtitle"},"Buat permohonan layanan baru untuk jemaat")],-1))])]),e("div",ae,[e("form",{onSubmit:N(D,["prevent"]),class:"card premium-form-card"},[e("div",te,[e("div",ie,[e("div",oe,[r(i(K),{size:"18"})]),s[9]||(s[9]=e("h3",{class:"section-title"},"Informasi Dasar Permintaan",-1))]),e("div",le,[s[10]||(s[10]=e("label",{class:"form-label"},"Cari Jemaat (NIK / Nama)",-1)),p.value?_("",!0):(n(),l("div",ne,[e("div",re,[r(i(O),{size:"18",class:"input-icon"}),f(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>v.value=a),onInput:j,type:"text",placeholder:"Ketik nama jemaat...",disabled:u.value},null,40,de),[[w,v.value]])]),r(A,{name:"fade-slide"},{default:U(()=>[h.value&&b.value.length>0?(n(),l("div",ue,[(n(!0),l(g,null,q(b.value,a=>(n(),l("div",{key:a.id,class:"result-item",onClick:Ne=>B(a)},[e("div",me,[e("span",pe,m(a.nama_lengkap),1),e("span",ve,m(a.nik),1)]),e("div",_e,m(a.no_hp||"No HP tidak ada"),1)],8,ce))),128))])):_("",!0)]),_:1})])),p.value?(n(),l("div",fe,[e("div",be,[r(i(J),{size:"18"})]),e("div",he,[e("div",ge,m(p.value.nama_lengkap),1),e("div",ye,m(p.value.nik),1)]),i(d).user?.can_approve_service?(n(),l("button",{key:0,type:"button",onClick:s[2]||(s[2]=a=>{p.value=null,o.value.member_id=""}),class:"remove-btn"},[r(i(G),{size:"14"})])):_("",!0)])):_("",!0)]),e("div",ke,[s[12]||(s[12]=e("label",{class:"form-label"},"Jenis Layanan",-1)),e("div",we,[r(i(X),{size:"18",class:"input-icon"}),f(e("select",{"onUpdate:modelValue":s[3]||(s[3]=a=>o.value.service_type_id=a),required:"",disabled:u.value,class:"select-input"},[s[11]||(s[11]=e("option",{value:""},"Pilih Layanan",-1)),(n(!0),l(g,null,q(S.value,a=>(n(),l("option",{key:a.id,value:a.id},m(a.name)+" ("+m(a.category?.name)+") ",9,Se))),128))],8,Ce),[[z,o.value.service_type_id]])])]),e("div",{class:E(["form-grid mt-4",{"single-col":!i(d).user?.can_approve_service}])},[e("div",xe,[s[13]||(s[13]=e("label",{class:"form-label"},"Tanggal Permintaan",-1)),e("div",Te,[r(i(Q),{size:"18",class:"input-icon"}),f(e("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>o.value.requested_at=a),type:"datetime-local",disabled:u.value,required:""},null,8,Be),[[w,o.value.requested_at]])])]),i(d).user?.can_approve_service?(n(),l("div",ze,[s[15]||(s[15]=e("label",{class:"form-label"},"Status Awal",-1)),e("div",qe,[r(i(W),{size:"18",class:"input-icon"}),f(e("select",{"onUpdate:modelValue":s[5]||(s[5]=a=>o.value.status=a),disabled:u.value,class:"select-input"},[...s[14]||(s[14]=[e("option",{value:"pending"},"Menunggu (Pending)",-1),e("option",{value:"approved"},"Langsung Disetujui",-1),e("option",{value:"scheduled"},"Langsung Dijadwalkan",-1),e("option",{value:"completed"},"Langsung Selesai",-1)])],8,Pe),[[z,o.value.status]])])])):_("",!0)],2),e("div",Le,[s[16]||(s[16]=e("label",{class:"form-label"},"Catatan Tambahan",-1)),e("div",Me,[r(i(Y),{size:"18",class:"input-icon",style:{top:"1rem"}}),f(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=a=>o.value.notes=a),rows:"3",class:"text-area-input",disabled:u.value,placeholder:"Keterangan tambahan..."},null,8,je),[[w,o.value.notes]])])])]),e("div",De,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[7]||(s[7]=a=>i(k).back()),disabled:u.value},"Batal",8,Ve),e("button",{type:"submit",class:"btn btn-primary",disabled:u.value},[u.value?(n(),l(g,{key:0},[s[17]||(s[17]=e("div",{class:"spinner small"},null,-1)),s[18]||(s[18]=e("span",null,"Menyimpan...",-1))],64)):(n(),l(g,{key:1},[r(i(H),{size:"18"}),s[19]||(s[19]=e("span",null,"Buat Permintaan",-1))],64))],8,Re)])],32)])]))}},Ye=V(Fe,[["__scopeId","data-v-9d0f8f14"]]);export{Ye as default};
