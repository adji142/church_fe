import{_ as te,u as ae,B as le,r as m,i as oe,c as o,x as u,d,a as e,k as n,g as ie,t as r,q as ne,h as C,F as x,n as w,e as L,T as N,j as _,o as l,m as V,w as T,b as S,v as $}from"./index-Mv3MxCR1.js";import{S as c}from"./sweetalert2.esm.all-BQxta0Da.js";import{A as de}from"./arrow-left-Cam99NkQ.js";import{C as re,X as B}from"./x-D8hPaNXE.js";import{C as j}from"./circle-check-big-BN4MHkMS.js";import{B as ue}from"./briefcase-DeOdw5oH.js";import{F as I}from"./file-text-CPaFxqa6.js";import{C as ce,S as me,E as ve}from"./square-pen-SUGTGtSY.js";import{C as R}from"./calendar-COvuOzBD.js";import{C as pe}from"./clock-Cw4-8-Ua.js";import{M as _e}from"./map-pin-DIz-n_0r.js";import{U as G}from"./users-D_w7s7_7.js";import{P as fe}from"./plus-BF4bXWAK.js";import{H as he}from"./history-w-TXIIRl.js";import{C as be}from"./circle-alert-BaaFyc9X.js";import"./createLucideIcon-DBeZuCHW.js";const ye={class:"master-data-page"},ke={key:0,class:"header-section"},ge={class:"header-left"},Ce={class:"title-group"},xe={class:"flex items-center gap-3"},we={class:"page-title"},ze={class:"page-subtitle"},De={key:0,class:"header-actions"},Se={key:1,class:"loading-full"},$e={key:2,class:"detail-container"},Be={class:"detail-grid"},Ue={class:"main-column"},qe={class:"card info-card mb-6"},Le={class:"card-header"},Ne={class:"card-icon"},Te={class:"card-body"},je={class:"info-grid"},Ie={class:"info-item"},Pe={class:"text-dark font-bold"},Me={class:"info-item"},Ae={class:"info-item"},Ee={class:"info-item"},Fe={class:"category-tag"},Ve={class:"info-item full"},Re={class:"requirements-list"},Ge={key:0,class:"text-danger"},Je={key:0,class:"info-item full"},Ke={class:"notes-box"},Oe={class:"card doc-card"},We={class:"card-header"},He={class:"card-icon"},Xe={key:0,class:"upload-btn"},Qe={class:"card-body p-0"},Ye={key:0,class:"empty-docs"},Ze={key:1,class:"table-container"},es={class:"modern-table"},ss={class:"flex items-center gap-2"},ts={class:"file-thumb"},as={class:"font-bold text-dark"},ls={class:"text-xs text-muted"},os={class:"text-right"},is=["href"],ns={class:"sidebar-column"},ds={class:"card mb-6"},rs={class:"card-header"},us={class:"card-icon"},cs={class:"card-body"},ms={key:0,class:"schedule-display"},vs={class:"sch-item"},ps={key:0,class:"sch-item"},_s={key:1,class:"text-muted text-xs italic"},fs={class:"card mb-6"},hs={class:"card-header"},bs={class:"card-icon"},ys={class:"card-body p-0"},ks={key:0,class:"p-5 text-center text-muted text-xs italic"},gs={key:1,class:"assignment-list"},Cs={class:"user-avatar"},xs={class:"assign-info"},ws={class:"user-name"},zs={class:"user-role"},Ds=["onClick"],Ss={class:"card"},$s={class:"card-header"},Bs={class:"card-icon"},Us={class:"card-body p-0"},qs={class:"timeline"},Ls={class:"timeline-content"},Ns={class:"tm-header"},Ts={class:"tm-status"},js={class:"tm-date"},Is={key:0,class:"tm-notes"},Ps={class:"tm-user"},Ms={class:"modal-content"},As={class:"modal-header"},Es={class:"header-icon"},Fs={class:"form-group mb-4"},Vs={class:"form-group mb-4"},Rs={class:"form-group"},Gs={class:"modal-footer"},Js={class:"modal-content"},Ks={class:"modal-header"},Os={class:"header-icon"},Ws={class:"modal-body"},Hs={class:"form-group"},Xs={class:"autocomplete-wrapper"},Qs={key:0,class:"autocomplete-results"},Ys=["onClick"],Zs={class:"font-bold text-dark"},et={class:"text-xs text-muted"},st={key:0,class:"selected-member-card mt-4"},tt={class:"check-icon"},at={class:"member-info"},lt={class:"member-name"},ot={class:"modal-footer"},it=["disabled"],nt={__name:"ServiceRequestDetail",setup(dt){const J=le(),P=ie(),z=ae(),k=J.params.id,a=m(null),K=m(null),f=m(!1),h=m(!1);m(!1);const v=m({start_datetime:"",end_datetime:"",location:""}),g=m(""),D=m([]),M=m(""),b=m({user_id:null}),A=m(null),y=async()=>{try{const i=await _.get(`/service-requests/${k}`);if(a.value=i.data,a.value.schedule){const s=t=>{if(!t)return"";const p=new Date(t),F=p.getTimezoneOffset()*6e4;return new Date(p-F).toISOString().slice(0,16)};v.value={start_datetime:s(a.value.schedule.start_datetime),end_datetime:s(a.value.schedule.end_datetime),location:a.value.schedule.location}}}catch{c.fire("Error","Gagal memuat detail","error"),P.push({name:"ServiceRequestList"})}},U=async i=>{const{value:s}=await c.fire({title:"Konfirmasi",text:`Ubah status menjadi ${q(i)}?`,input:"textarea",inputPlaceholder:"Tambahkan catatan...",showCancelButton:!0});if(s!==void 0)try{await _.put(`/service-requests/${k}/status`,{status:i,notes:s}),y(),c.fire({icon:"success",title:"Berhasil",timer:1500,showConfirmButton:!1})}catch{c.fire("Error","Gagal update status","error")}},O=async i=>{const s=i.target.files[0];if(!s)return;const{value:t}=await c.fire({title:"Nama Dokumen",input:"text",inputValue:s.name,showCancelButton:!0});if(!t)return;const p=new FormData;p.append("file",s),p.append("document_name",t);try{await _.post(`/service-requests/${k}/documents`,p),y(),c.fire("Uploaded","Dokumen berhasil diunggah","success")}catch{c.fire("Error","Gagal upload","error")}},W=i=>a.value.documents?.some(s=>s.document_name.toLowerCase().includes(i.toLowerCase())),H=async()=>{try{await _.post(`/service-requests/${k}/schedule`,v.value),f.value=!1,y(),c.fire("Success","Jadwal disimpan","success")}catch{c.fire("Error","Gagal simpan jadwal","error")}},X=()=>{clearTimeout(A.value),A.value=setTimeout(async()=>{try{const i=await _.get("/users",{params:{search:g.value}});D.value=i.data.data}catch{}},300)},Q=i=>{b.value.user_id=i.id,M.value=i.name,D.value=[],g.value=i.name},Y=async()=>{if(b.value.user_id)try{await _.post(`/service-requests/${k}/assignments`,b.value),h.value=!1,y(),b.value.user_id=null,g.value=""}catch{c.fire("Error","Gagal assign","error")}},Z=async i=>{if((await c.fire({title:"Hapus petugas?",icon:"warning",showCancelButton:!0})).isConfirmed)try{await _.delete(`/service-requests/assignments/${i}`),y()}catch{c.fire("Error","Gagal hapus","error")}},ee=i=>`undefined/storage/${i}`,E=i=>{if(!i)return"-";const s=new Date(i);return isNaN(s)?i:s.toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},se=i=>{if(!i)return"-";const s=new Date(i);return isNaN(s)?i:s.toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"})},q=i=>({pending:"Menunggu",approved:"Disetujui",rejected:"Ditolak",scheduled:"Dijadwalkan",completed:"Selesai",cancelled:"Batal"})[i]||i;return oe(()=>y()),(i,s)=>(l(),o("div",ye,[a.value?(l(),o("div",ke,[e("div",ge,[e("button",{class:"back-btn",onClick:s[0]||(s[0]=t=>n(P).push({name:"ServiceRequestList"}))},[d(n(de),{size:"20"})]),e("div",Ce,[e("div",xe,[e("h1",we,r(a.value.request_number),1),e("span",{class:ne(["status-badge","tr-"+a.value.status])},r(q(a.value.status)),3)]),e("p",ze,"Layanan: "+r(a.value.service_type?.name),1)])]),n(z).user?.can_approve_service?(l(),o("div",De,[a.value.status==="pending"?(l(),o("button",{key:0,class:"btn btn-primary",onClick:s[1]||(s[1]=t=>U("approved"))},[d(n(re),{size:"18"}),s[16]||(s[16]=C()),s[17]||(s[17]=e("span",null,"Setujui",-1))])):u("",!0),a.value.status==="pending"?(l(),o("button",{key:1,class:"btn btn-danger",onClick:s[2]||(s[2]=t=>U("rejected"))},[d(n(B),{size:"18"}),s[18]||(s[18]=C()),s[19]||(s[19]=e("span",null,"Tolak",-1))])):u("",!0),a.value.status==="scheduled"?(l(),o("button",{key:2,class:"btn btn-success",onClick:s[3]||(s[3]=t=>U("completed"))},[d(n(j),{size:"18"}),s[20]||(s[20]=C()),s[21]||(s[21]=e("span",null,"Selesaikan",-1))])):u("",!0)])):u("",!0)])):u("",!0),a.value?(l(),o("div",$e,[e("div",Be,[e("div",Ue,[e("div",qe,[e("div",Le,[e("div",Ne,[d(n(ue),{size:"18"})]),s[23]||(s[23]=e("h3",{class:"card-title"},"Informasi Layanan & Jemaat",-1))]),e("div",Te,[e("div",je,[e("div",Ie,[s[24]||(s[24]=e("label",null,"Nama Jemaat",-1)),e("p",Pe,r(a.value.member?.nama_lengkap),1)]),e("div",Me,[s[25]||(s[25]=e("label",null,"NIK / Identitas",-1)),e("p",null,r(a.value.member?.nik||"-"),1)]),e("div",Ae,[s[26]||(s[26]=e("label",null,"No. Telepon",-1)),e("p",null,r(a.value.member?.no_hp||"-"),1)]),e("div",Ee,[s[27]||(s[27]=e("label",null,"Kategori Layanan",-1)),e("p",null,[e("span",Fe,r(a.value.service_type?.category?.name),1)])]),e("div",Ve,[s[28]||(s[28]=e("label",null,"Daftar Pesyaratan",-1)),e("div",Re,[(l(!0),o(x,null,w(a.value.service_type?.requirements,t=>(l(),o("div",{key:t.id,class:"req-item"},[W(t.name)?(l(),V(n(j),{key:0,size:"14",class:"text-success"})):(l(),V(n(be),{key:1,size:"14",class:"text-warning"})),e("span",null,[C(r(t.name)+" ",1),t.is_required?(l(),o("small",Ge,"*")):u("",!0)])]))),128))])]),a.value.notes?(l(),o("div",Je,[s[29]||(s[29]=e("label",null,"Catatan Tambahan",-1)),e("div",Ke,r(a.value.notes),1)])):u("",!0)])])]),e("div",Oe,[e("div",We,[e("div",He,[d(n(I),{size:"18"})]),s[32]||(s[32]=e("h3",{class:"card-title"},"Berkas & Dokumen",-1)),a.value.status!=="completed"&&a.value.status!=="rejected"?(l(),o("label",Xe,[e("input",{type:"file",ref_key:"fileInput",ref:K,onChange:O,hidden:""},null,544),d(n(ce),{size:"16"}),s[30]||(s[30]=C()),s[31]||(s[31]=e("span",null,"Upload",-1))])):u("",!0)]),e("div",Qe,[a.value.documents?.length===0?(l(),o("div",Ye,[d(n(I),{size:"32",class:"mb-2 opacity-50"}),s[33]||(s[33]=e("p",null,"Belum ada dokumen yang diunggah.",-1))])):(l(),o("div",Ze,[e("table",es,[s[34]||(s[34]=e("thead",null,[e("tr",null,[e("th",null,"Nama Berkas"),e("th",null,"Waktu Unggah"),e("th",{class:"text-right"},"Aksi")])],-1)),e("tbody",null,[(l(!0),o(x,null,w(a.value.documents,t=>(l(),o("tr",{key:t.id,class:"row-hover"},[e("td",null,[e("div",ss,[e("div",ts,[d(n(I),{size:"14"})]),e("span",as,r(t.document_name),1)])]),e("td",ls,r(E(t.uploaded_at)),1),e("td",os,[e("a",{href:ee(t.file_path),target:"_blank",class:"action-btn-small",title:"Lihat"},[d(n(ve),{size:"14"})],8,is)])]))),128))])])]))])])]),e("div",ns,[e("div",ds,[e("div",rs,[e("div",us,[d(n(R),{size:"18"})]),s[35]||(s[35]=e("h3",{class:"card-title"},"Jadwal",-1)),a.value.status!=="completed"&&a.value.status!=="rejected"&&n(z).user?.can_approve_service?(l(),o("button",{key:0,class:"icon-link-btn",onClick:s[4]||(s[4]=t=>f.value=!0)},[d(n(me),{size:"16"})])):u("",!0)]),e("div",cs,[a.value.schedule?(l(),o("div",ms,[e("div",vs,[d(n(pe),{size:"14",class:"text-indigo"}),e("span",null,r(E(a.value.schedule.start_datetime)),1)]),a.value.schedule.location?(l(),o("div",ps,[d(n(_e),{size:"14",class:"text-indigo"}),e("span",null,r(a.value.schedule.location),1)])):u("",!0)])):(l(),o("div",_s,"Belum ada jadwal yang diatur."))])]),e("div",fs,[e("div",hs,[e("div",bs,[d(n(G),{size:"18"})]),s[36]||(s[36]=e("h3",{class:"card-title"},"Petugas",-1)),a.value.status!=="completed"&&a.value.status!=="rejected"&&n(z).user?.can_approve_service?(l(),o("button",{key:0,class:"icon-link-btn",onClick:s[5]||(s[5]=t=>h.value=!0)},[d(n(fe),{size:"16"})])):u("",!0)]),e("div",ys,[a.value.assignments?.length===0?(l(),o("div",ks," Petugas belum ditugaskan. ")):(l(),o("div",gs,[(l(!0),o(x,null,w(a.value.assignments,t=>(l(),o("div",{key:t.id,class:"assign-item"},[e("div",Cs,r(t.user?.name?.charAt(0)),1),e("div",xs,[e("div",ws,r(t.user?.name),1),e("div",zs,r(t.position?.name||"Petugas"),1)]),a.value.status!=="completed"&&n(z).user?.can_approve_service?(l(),o("button",{key:0,class:"delete-assign",onClick:p=>Z(t.id)},[d(n(B),{size:"14"})],8,Ds)):u("",!0)]))),128))]))])]),e("div",Ss,[e("div",$s,[e("div",Bs,[d(n(he),{size:"18"})]),s[37]||(s[37]=e("h3",{class:"card-title"},"Riwayat",-1))]),e("div",Us,[e("div",qs,[(l(!0),o(x,null,w(a.value.histories,t=>(l(),o("div",{key:t.id,class:"timeline-item"},[s[38]||(s[38]=e("div",{class:"timeline-point"},null,-1)),e("div",Ls,[e("div",Ns,[e("span",Ts,r(q(t.status_to||"Created")),1),e("span",js,r(se(t.created_at)),1)]),t.notes?(l(),o("p",Is,r(t.notes),1)):u("",!0),e("p",Ps,"Oleh: "+r(t.user?.name||"Sistem"),1)])]))),128))])])])])])])):(l(),o("div",Se,[...s[22]||(s[22]=[e("div",{class:"spinner"},null,-1),e("p",null,"Memuat detail permintaan...",-1)])])),d(N,{name:"modal-fade"},{default:L(()=>[f.value?(l(),o("div",{key:0,class:"modal-overlay",onClick:s[11]||(s[11]=T(t=>f.value=!1,["self"]))},[e("div",Ms,[e("div",As,[e("div",Es,[d(n(R),{size:"24"})]),s[39]||(s[39]=e("div",{class:"header-text"},[e("h2",null,"Ubah Jadwal"),e("p",null,"Waktu dan lokasi pelaksanaan layanan")],-1)),e("button",{class:"close-btn",onClick:s[6]||(s[6]=t=>f.value=!1)},[d(n(B),{size:"20"})])]),e("form",{onSubmit:T(H,["prevent"]),class:"modal-body"},[e("div",Fs,[s[40]||(s[40]=e("label",{class:"form-label"},"Waktu Mulai",-1)),S(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>v.value.start_datetime=t),type:"datetime-local",class:"modal-input",required:""},null,512),[[$,v.value.start_datetime]])]),e("div",Vs,[s[41]||(s[41]=e("label",{class:"form-label"},"Waktu Selesai",-1)),S(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>v.value.end_datetime=t),type:"datetime-local",class:"modal-input"},null,512),[[$,v.value.end_datetime]])]),e("div",Rs,[s[42]||(s[42]=e("label",{class:"form-label"},"Lokasi",-1)),S(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>v.value.location=t),type:"text",class:"modal-input",placeholder:"Contoh: Gereja Utama"},null,512),[[$,v.value.location]])]),e("div",Gs,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[10]||(s[10]=t=>f.value=!1)},"Batal"),s[43]||(s[43]=e("button",{type:"submit",class:"btn btn-primary"},"Simpan Jadwal",-1))])],32)])])):u("",!0)]),_:1}),d(N,{name:"modal-fade"},{default:L(()=>[h.value?(l(),o("div",{key:0,class:"modal-overlay",onClick:s[15]||(s[15]=T(t=>h.value=!1,["self"]))},[e("div",Js,[e("div",Ks,[e("div",Os,[d(n(G),{size:"24"})]),s[44]||(s[44]=e("div",{class:"header-text"},[e("h2",null,"Tugaskan Petugas"),e("p",null,"Pilih petugas untuk membantu layanan ini")],-1)),e("button",{class:"close-btn",onClick:s[12]||(s[12]=t=>h.value=!1)},[d(n(B),{size:"20"})])]),e("div",Ws,[e("div",Hs,[s[45]||(s[45]=e("label",{class:"form-label"},"Cari User / Staff",-1)),e("div",Xs,[S(e("input",{"onUpdate:modelValue":s[13]||(s[13]=t=>g.value=t),onInput:X,type:"text",placeholder:"Ketik nama user...",class:"modal-input"},null,544),[[$,g.value]]),d(N,{name:"fade-slide"},{default:L(()=>[D.value.length>0?(l(),o("div",Qs,[(l(!0),o(x,null,w(D.value,t=>(l(),o("div",{key:t.id,class:"result-item",onClick:p=>Q(t)},[e("div",Zs,r(t.name),1),e("div",et,r(t.email),1)],8,Ys))),128))])):u("",!0)]),_:1})])]),b.value.user_id?(l(),o("div",st,[e("div",tt,[d(n(j),{size:"18"})]),e("div",at,[e("div",lt,r(M.value),1)])])):u("",!0),e("div",ot,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[14]||(s[14]=t=>h.value=!1)},"Batal"),e("button",{type:"button",class:"btn btn-primary",onClick:Y,disabled:!b.value.user_id},"Tugaskan",8,it)])])])])):u("",!0)]),_:1})]))}},zt=te(nt,[["__scopeId","data-v-1fb1128d"]]);export{zt as default};
